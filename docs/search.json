[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Lista de Morbidades",
    "section": "",
    "text": "Consolidado de Morbidades\nAqui estão as informações sobre as morbidades crônicas avaliadas junto aos pacientes, Multimorbidade e seus critérios, polifarmácia e hiperpolifarmácia (e seus critérios), bem como números absolutos e prevalências por grupo etári, sexo, ESF, clínica da família e área programática.\nAtualizado em 27 de novembro de 2025.",
    "crumbs": [
      "Consolidado de Morbidades"
    ]
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "1  Tabela Fato pacientes - Morbidades e fármacos de uso crônico para cada paciente",
    "section": "",
    "text": "1.1 Abaixo a query que gera estas informações:\nAqui está a query para a categorização de cada paciente, de acordo com área programática, clínica da família e ESF para cada morbidade listada.\nESFs divididas em sub-ESF (1, 2, 3) foram agregadas em uma única ESF.\nA maioria de condições foi categorizada apenas com CIDs, mas há condições específicas que foram categorizadas também por outros critérios clínicos:\nAlém disso, há duas outras condições clínicas relacionadas ao uso de medicamentos crônicos:\nAo final, é calculada a Multimorbidade, considerada aqui como ocorrência de duas ou mais condições crônicas em um mesmo indivíduo.\nNem todas as morbidades aqui capturadas foram utilizadas para o cálculo da Multimorbidade. As condiç;ões mantidas para o cálculo da Multimorbidade foram as seguintes:\nHipertensão Arterial, Diabetes Mellitus, Cardiopatia Isquêmica, Insuficiência Cardíaca, AVC, Insuficiência Renal Crônica, Demência, Doenpça Pulmonar Obstrutiva Crônica, Úlcera Péptica, Neoplasias, Doença Hepática, HIV/AIDS, Doenças da Tireoide, Arritmia, Distúrbio de Coagulação, Doença Reumatológica, Doença Valvular, Doença Circulatória Pulmonar, Doença Neurológica, Doença Vascular Periférica, Plegias e deficiências motoras, Anemia, Transtorno por Uso de Álcool, Transtorno por Uso de Drogas, Psicoses e esquizofrenia, Desnutrição, Deficiência Intelectual, Doença Ocular e perda de visão, Doenças dos ouvidos e perda de audição, Condição Dolorosa Crônica, Bronquiectasia.\nA tabela morbidades está aqui - rj-sms-sandbox.sub_pav_us.morbidades_20251015\n#| eval: false   # não executa\n#| echo: true    # exibe o código\n#| include: true # garante que o chunk aparece no documento\n\n\n-- ============================================\n-- TABELA FATO MORBIDADES - VERSÃO LIMPA\n-- Apenas morbidades + medicamentos crônicos\n-- ============================================\n\n\n\nWITH \n-- CTE 0: Identificação de pacientes com HIV/AIDS\nhiv_cpf_raw AS (\n  SELECT\n    h.id_prontuario_global,\n    h.id_cnes,\n    h.aids_doenca_atual_ano_1_teste,\n    a.patient_cpf AS patient_cpf_raw,\n    REGEXP_REPLACE(CAST(a.patient_cpf AS STRING), r'\\D', '') AS cpf\n  FROM `rj-sms.brutos_prontuario_vitacare_historico.hiv` AS h\n  JOIN `rj-sms.brutos_prontuario_vitacare_historico.acto` AS a\n  USING (id_prontuario_global)\n  WHERE NULLIF(TRIM(CAST(a.patient_cpf AS STRING)), '') IS NOT NULL\n),\n\nhiv_cpf AS (\n  SELECT *\n  FROM hiv_cpf_raw\n  WHERE LENGTH(cpf) = 11\n  QUALIFY ROW_NUMBER() OVER (PARTITION BY cpf ORDER BY id_prontuario_global DESC) = 1\n),\n\nexames_cpf_raw AS (\n  SELECT\n    ea.id_hci,\n    ea.entrada_data,\n    ea.paciente_cpf AS paciente_cpf_raw,\n    er.tipo,\n    er.descricao,\n    REGEXP_REPLACE(CAST(ea.paciente_cpf AS STRING), r'\\D', '') AS cpf\n  FROM `rj-sms.saude_historico_clinico.episodio_assistencial` AS ea\n  CROSS JOIN UNNEST(ea.exames_realizados) AS er\n  WHERE ea.exames_realizados IS NOT NULL\n    AND ARRAY_LENGTH(ea.exames_realizados) &gt; 0\n    AND er.descricao IS NOT NULL\n    AND REGEXP_CONTAINS(er.descricao, r'(?i)\\b(cd4|cv|carga viral)\\b')\n    AND NULLIF(TRIM(CAST(ea.paciente_cpf AS STRING)), '') IS NOT NULL\n),\n\nexames_cpf_last AS (\n  SELECT *\n  FROM exames_cpf_raw\n  WHERE LENGTH(cpf) = 11\n  QUALIFY ROW_NUMBER() OVER (\n    PARTITION BY cpf\n    ORDER BY entrada_data DESC, id_hci DESC\n  ) = 1\n),\n\nhiv_completo AS (\n  SELECT\n    h.cpf,\n    h.id_prontuario_global,\n    h.id_cnes,\n    h.aids_doenca_atual_ano_1_teste,\n    e.entrada_data AS data_ultimo_exame\n  FROM hiv_cpf AS h\n  LEFT JOIN exames_cpf_last AS e\n  USING (cpf)\n),\n\n-- CTE: Pacientes com DRC por eGFR\ndrc_egfr AS (\n  SELECT DISTINCT cpf\n  FROM `rj-sms-sandbox.sub_pav_us.MM_eGFR`\n  WHERE ckd_stage IN (\n    'G2 - Levemente diminuída',\n    'G3 - Moderadamente diminuída',\n    'G4 - Severamente diminuída',\n    'G5 - Falência renal'\n  )\n),\n\n-- CTE 1: Agregação dos episódios assistenciais\nepisodios_agregados AS (\n  SELECT \n    ep.paciente.cpf,\n    ep.id_hci,\n    ep.entrada_data,\n    ep.profissional_saude_responsavel.nome AS profissional_nome,\n    ep.profissional_saude_responsavel.especialidade AS profissional_especialidade,\n    ep.paciente.id_paciente AS id_paciente,\n    ep.paciente.data_nascimento AS data_nascimento,\n    ep.medidas.altura AS altura,\n    ep.medidas.peso AS peso,\n    ep.medidas.circunferencia_abdominal AS circunferencia_abdominal,\n    ep.medidas.glicemia AS glicemia,\n    ep.medidas.hemoglobina_glicada AS hemoglobina_glicada,\n    ep.medidas.pressao_sistolica AS pressao_sistolica,\n    ep.medidas.pressao_diastolica AS pressao_diastolica,\n    STRING_AGG(CAST(condicao.id AS STRING), \"/\" ORDER BY condicao.id) AS condicoes_ids,\n    STRING_AGG(condicao.descricao, \"/\" ORDER BY condicao.id) AS condicoes_descricoes,\n    STRING_AGG(CAST(prescricao.id AS STRING), \"/\" ORDER BY prescricao.id) AS prescricoes_ids,\n    STRING_AGG(prescricao.nome, \"/\" ORDER BY prescricao.id) AS prescricoes_nomes\n  FROM `rj-sms.saude_historico_clinico.episodio_assistencial` ep\n  LEFT JOIN UNNEST(ep.condicoes) AS condicao\n  LEFT JOIN UNNEST(ep.prescricoes) AS prescricao\n  WHERE ep.paciente.cpf IS NOT NULL\n  GROUP BY \n    ep.paciente.cpf, ep.id_hci, ep.entrada_data,\n    ep.profissional_saude_responsavel.nome, ep.profissional_saude_responsavel.especialidade,\n    ep.paciente.id_paciente, ep.paciente.data_nascimento,\n    ep.medidas.altura, ep.medidas.peso, ep.medidas.circunferencia_abdominal,\n    ep.medidas.glicemia, ep.medidas.hemoglobina_glicada,\n    ep.medidas.pressao_sistolica, ep.medidas.pressao_diastolica\n),\n\n-- CTE 2: Junção com dados dos pacientes e estabelecimentos\nbase_dados AS (\n  SELECT \n    p.cpf,\n    p.dados.nome,\n    CASE \n        WHEN UPPER(pac_vitacare.sexo) IN ('MALE', 'MASCULINO') THEN 'masculino'\n        WHEN UPPER(pac_vitacare.sexo) IN ('FEMALE', 'FEMININO') THEN 'feminino'\n        ELSE NULL\n    END AS genero,\n    p.dados.raca, \n    p.dados.obito_indicador, \n    p.dados.obito_data, \n    p.equipe_saude_familia[SAFE_OFFSET(0)].id_ine AS INE,\n    REGEXP_REPLACE(\n      p.equipe_saude_familia[SAFE_OFFSET(0)].nome, \n      r'\\s+(I|II|III|IV|V|VI|VII|VIII|IX|X|XI|XII|XIII|XIV|XV|XVI|XVII|XVIII|XIX|XX)\\s*$', \n      ''\n    ) AS ESF,\n    p.equipe_saude_familia[SAFE_OFFSET(0)].clinica_familia.id_cnes AS CNES, \n    REPLACE(p.equipe_saude_familia[SAFE_OFFSET(0)].clinica_familia.nome, 'Policlinica Newton Bethlem', 'CMS Newton Bethlem') AS clinica_familia,\n    ea.id_hci,\n    ea.entrada_data,\n    ea.profissional_nome,\n    ea.profissional_especialidade,\n    ea.id_paciente,\n    ea.data_nascimento,\n    ea.altura,\n    ea.peso,\n    ea.circunferencia_abdominal,\n    ea.glicemia,\n    ea.hemoglobina_glicada,\n    ea.pressao_sistolica,\n    ea.pressao_diastolica,\n    ea.condicoes_ids,\n    ea.condicoes_descricoes,\n    ea.prescricoes_ids,\n    ea.prescricoes_nomes,\n    est.id_unidade,\n    est.nome_limpo AS estabelecimento_nome,\n    est.area_programatica\n  FROM `rj-sms.saude_historico_clinico.paciente` p\n  LEFT JOIN episodios_agregados ea ON p.cpf = ea.cpf\n  LEFT JOIN `rj-sms.saude_dados_mestres.estabelecimento` est \n    ON p.equipe_saude_familia[SAFE_OFFSET(0)].clinica_familia.id_cnes = est.id_cnes\n  LEFT JOIN `rj-sms.brutos_prontuario_vitacare.paciente` pac_vitacare\n    ON p.cpf = pac_vitacare.cpf\n  WHERE \n    NOT REGEXP_CONTAINS(UPPER(COALESCE(p.equipe_saude_familia[SAFE_OFFSET(0)].nome, '')), r'ESB')\n    AND p.equipe_saude_familia[SAFE_OFFSET(0)].nome IS NOT NULL\n    AND TRIM(p.equipe_saude_familia[SAFE_OFFSET(0)].nome) != ''\n    AND est.area_programatica IS NOT NULL\n    AND p.equipe_saude_familia[SAFE_OFFSET(0)].clinica_familia.nome IS NOT NULL\n    AND p.cpf IS NOT NULL\n    AND ea.id_paciente IS NOT NULL\n    AND (p.dados.obito_indicador = FALSE OR p.dados.obito_indicador IS NULL)\n    AND p.dados.obito_data IS NULL\n),\n\n-- CTE 3: Identificação de morbidades\nmorbidades_temp AS (\n  SELECT \n    *,\n    -- Hipertensão\n    CASE WHEN (\n      REGEXP_CONTAINS(condicoes_ids, r'I10|I11|I12|I13|I14|I15|I16|O100|O104|O109|O13|R030')\n      OR pressao_sistolica &gt; 180 OR pressao_diastolica &gt; 110\n      OR REGEXP_CONTAINS(prescricoes_nomes, r'HIDROCLOROTIAZIDA|CLORTALIDONA|INDAPAMIDA|FUROSEMIDA|ESPIRONOLACTONA|CAPTOPRIL|ENALAPRIL|LISINOPRIL|RAMIPRIL|PERINDOPRIL|BENAZEPRIL|LOSARTANA|VALSARTANA|CANDESARTANA|IRBESARTANA|OLMESARTANA|TELMISARTANA|ANLODIPINO|NIFEDIPINO|FELODIPINO|VERAPAMIL|DILTIAZEM|ATENOLOL|PROPRANOLOL|METOPROLOL|CARVEDILOL|BISOPROLOL|METILDOPA|CLONIDINA|HIDRALAZINA|NITROPRUSSETO DE SÓDIO|ALISQUIRENO')\n    ) THEN TRUE ELSE FALSE END AS HAS_temp,\n    \n    -- Diabetes\n    CASE WHEN (\n      REGEXP_CONTAINS(condicoes_ids, r'E10|E11|E12|E13|E14|O24|H360|H280|G632|G590|G990|N083|M142')\n      OR glicemia &gt;= 126 OR hemoglobina_glicada &gt;= 6.5\n      OR REGEXP_CONTAINS(prescricoes_nomes, r'METFORMINA|GLIFAGE|GLICLAZIDA|GLIBENCLAMIDA|DAPAGLIFOZINA|INSULINA|NPH|GLIMEPIRID|GLIPIZIDA|REPAGLINIDA|NATEGLINIDA|GLITAZONA|GLIPTINA|GLIFOZINA|EXENATIDA|DULAGLUTIDA|SEMAGLUTIDA|LIXISENATIDA|TIRZEPATIDA|LISPRO|ASPARTE|GLULISINA|GLARGINA|DETEMIR|DEGLUDECA')\n    ) THEN TRUE ELSE FALSE END AS DM_temp,\n    \n    -- Pré-diabetes\n    CASE WHEN ((glicemia &gt;= 100 AND glicemia &lt; 126) OR (hemoglobina_glicada &gt;= 5.7 AND hemoglobina_glicada &lt; 6.5))\n    THEN TRUE ELSE FALSE END AS pre_DM_temp,\n    \n    -- Cardiopatia isquêmica\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'I21|I22|I252') THEN TRUE ELSE FALSE END AS CI_temp,\n    \n    -- Insuficiência cardíaca\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'I110|I130|I132|I420|I425|I426|I427|I428|I429|I43|I50|I517|P290') THEN TRUE ELSE FALSE END AS ICC_temp,\n    \n    -- AVC\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'I6|G45|G46|H340') THEN TRUE ELSE FALSE END AS stroke_temp,\n    \n    -- Doença renal crônica (CID + eGFR)\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'I120|I131|N032|N033|N034|N035|N036|N037|N052|N053|N054|N055|N056|N057|N18|N19|N250|Z490|Z491|Z492|Z940|Z992') THEN TRUE ELSE FALSE END AS IRC_CID_temp,\n    \n    -- Demência\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'F00|F01|F02|F03|F051|G30|G310|G311') THEN TRUE ELSE FALSE END AS dementia_temp,\n    \n    -- DPOC\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'I278|I279|J4|J60|J61|J62|J63|J64|J65|J66|J67|J684|J701|J703') THEN TRUE ELSE FALSE END AS COPD_temp,\n    \n    -- Úlcera péptica\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'K25|K26|K27|K28') THEN TRUE ELSE FALSE END AS peptic_temp,\n    \n    -- Neoplasias\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'\\bC50\\d*\\b') THEN TRUE ELSE FALSE END AS neo_mama_temp,\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'\\bC53\\d*\\b') THEN TRUE ELSE FALSE END AS neo_colo_temp,\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'\\bC5(1|2|4|5|6|7|8)\\d*\\b') THEN TRUE ELSE FALSE END AS neo_fem_estrita_temp,\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'\\bC6(0|1|2|3)\\d*\\b') THEN TRUE ELSE FALSE END AS neo_masc_estrita_temp,\n    CASE \n      WHEN REGEXP_CONTAINS(condicoes_ids, r'\\bC(0[0-9]|[12][0-9]|3[0-9]|4[0-9]|5[0-9]|6[0-9]|7[0-9]|8[0-9]|9[0-7])\\d*\\b')\n       AND NOT REGEXP_CONTAINS(condicoes_ids, r'\\bC50\\d*\\b')\n       AND NOT REGEXP_CONTAINS(condicoes_ids, r'\\bC53\\d*\\b')\n       AND NOT REGEXP_CONTAINS(condicoes_ids, r'\\bC5(1|2|4|5|6|7|8)\\d*\\b')\n       AND NOT REGEXP_CONTAINS(condicoes_ids, r'\\bC6(0|1|2|3)\\d*\\b')\n       AND NOT REGEXP_CONTAINS(condicoes_ids, r'\\bC44\\d*\\b')\n    THEN TRUE ELSE FALSE \n    END AS neo_ambos_temp,\n    \n    -- Doença hepática\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'B18|I85|I859|I864|I982|K700|K701|K702|K703|K704|K709|K711|K713|K715|K717|K721|K729|K73|K74|K760|K762|K763|K764|K765|K766|K767|K768|K769|Z944') THEN TRUE ELSE FALSE END AS liver_temp,\n    \n    -- HIV/AIDS (critérios combinados: CID + ARV + base HIV)\n    CASE WHEN (\n      REGEXP_CONTAINS(condicoes_ids, r'B20|B21|B22|B24|Z21|R75|O987|P352')\n      OR REGEXP_CONTAINS(prescricoes_nomes, r'(?i)\\b(ABACAVIR|ABC|ZIDOVUDINA|AZT|LAMIVUDINA|3TC|EMTRICITABINA|FTC|TENOFOVIR(?:\\s+(?:DISOPROXIL|FUMARATO|ALAFENAMIDA))?|TDF|TAF|DIDANOSINA|DDI|ESTAVUDINA|D4T|EFAVIRENZ|NEVIRAPINA|ETRAVIRINA|RILPIVIRINA|DORAVIRINA|ATAZANAVIR|DARUNAVIR|LOPINAVIR|SAQUINAVIR|INDINAVIR|NELFINAVIR|FOSAMPRENAVIR|AMPRENAVIR|TIPRANAVIR|RITONAVIR|COBICISTAT|COBICISTATE|RALTEGRAVIR|ELVITEGRAVIR|DOLUTEGRAVIR|BICTEGRAVIR|CABOTEGRAVIR|MARAVIROC|MARAVIROQUE|ENFUVIRTIDA|FOSTEMSAVIR|IBALIZUMABE|LENACAPAVIR)\\b')\n    ) THEN TRUE ELSE FALSE END AS SIDA_temp,\n    \n    -- Doenças da tireóide\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'E00|E01|E02|E03|E890|E05|E06') THEN TRUE ELSE FALSE END AS tireoide_temp,\n    \n    -- Arritmias\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'I441|I442|I443|I456|I459|I47|I48|I49|R000|R001|R008|T821|Z450|Z950') THEN TRUE ELSE FALSE END AS arritmia_temp,\n    \n    -- Distúrbio de coagulação\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'D65|D66|D67|D68|D691|D693|D694|D695|D696') THEN TRUE ELSE FALSE END AS coagulo_temp,\n    \n    -- Doença reumatológica\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'L93|L940|L941|L943|M05|M06|M08|M120|M123|M30|M310|M313|M32|M33|M34|M35|M45|M461|M468|M469') THEN TRUE ELSE FALSE END AS reumato_temp,\n    \n    -- Doença valvular\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'A520|I05|I06|I07|I08|I091|I098|I34|I35|I36|I37|I38|I39|Q230|Q231|Q232|Q233|Z952|Z953|Z954') THEN TRUE ELSE FALSE END AS valvular_temp,\n    \n    -- Doença circulatória pulmonar\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'I26|I27|I280|I288|I289') THEN TRUE ELSE FALSE END AS circ_pulm_temp,\n    \n    -- Doença neurológica\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'G10|G11|G12|G13|G20|G21|G22|G254|G255|G312|G318|G319|G32|G35|G36|G37|G40|G41|G931|G934|R470|R56') THEN TRUE ELSE FALSE END AS neuro_temp,\n    \n    -- Doença vascular periférica\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'I70|I71|I731|I738|I739|I771|I790|I792|K551|K558|K559|Z958|Z959') THEN TRUE ELSE FALSE END AS vascular_periferica_temp,\n    \n    -- Plegia\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'G041|G114|G801|G802|G81|G82|G830|G831|G832|G833|G834|G839') THEN TRUE ELSE FALSE END AS plegia_temp,\n    \n    -- Dislipidemia\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'E78') THEN TRUE ELSE FALSE END AS dislipidemia_temp,\n    \n    -- Obesidade\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'E66') THEN TRUE ELSE FALSE END AS obesidade_temp,\n    \n    -- Anemias\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'D50|D51|D52|D53') THEN TRUE ELSE FALSE END AS anemias_temp,\n    \n    -- Transtorno por uso de álcool\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'F10|E52|G621|I426|K292|K700|K703|K709|T51|Z502|Z714|Z721') THEN TRUE ELSE FALSE END AS alcool_temp,\n    \n    -- Transtorno por uso de drogas\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'F11|F12|F13|F14|F15|F16|F18|F19|Z715|Z722') THEN TRUE ELSE FALSE END AS drogas_temp,\n    \n    -- Tabagismo\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'F17|Z716') THEN TRUE ELSE FALSE END AS tabaco_temp,\n    \n    -- Psicoses\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'F20|F21|F22|F23|F24|F25|F28|F29|F31') THEN TRUE ELSE FALSE END AS psicoses_temp,\n    \n    -- Depressão e ansiedade\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'F32|F33|F34|F38|F39|F40|F41') THEN TRUE ELSE FALSE END AS depre_ansiedade_temp,\n    \n    -- Desnutrição\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'E40|E41|E42|E43|E45|E46') THEN TRUE ELSE FALSE END AS desnutricao_temp,\n    \n    -- Deficiência intelectual\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'F70|F71|F72|F73|F78|F79') THEN TRUE ELSE FALSE END AS retardo_mental_temp,\n    \n    -- Deficiência motora\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'G041|G114|G801|G802|G81|G82|G830|G831|G832|G833|G834|G839|R26') THEN TRUE ELSE FALSE END AS descapacidade_motora_temp,\n    \n    -- Doenças oculares\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'H18|H201|H25|H26|H33|H360|H40|H42|H46|H540') THEN TRUE ELSE FALSE END AS olhos_temp,\n    \n    -- Perda auditiva\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'H90|H91') THEN TRUE ELSE FALSE END AS ouvidos_temp,\n    \n    -- Malformações congênitas\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'Q00|Q01|Q02|Q03|Q04|Q05|Q06|Q07|Q35|Q36|Q37|Q60|Q61|Q62|Q80|Q81|Q90|Q91|Q92|Q93|Q94|Q95|Q96|Q97|Q98|Q99') THEN TRUE ELSE FALSE END AS ma_formacoes_temp,\n    \n    -- Doenças de pele\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'L10|L12|L13|L14|L20|L40|L41|L43|L80|L89|L90|L990|Q850|Q851') THEN TRUE ELSE FALSE END AS pele_temp,\n    \n    -- Condição dolorosa crônica\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'G89|M54|M79[01247]|M25[56]|R52') THEN TRUE ELSE FALSE END AS painful_temp,\n    \n    -- Asma\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'J45|J46') THEN TRUE ELSE FALSE END AS asthma_temp,\n    \n    -- Doença diverticular\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'K57') THEN TRUE ELSE FALSE END AS diverticular_temp,\n    \n    -- Doença da próstata\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'N40|N41|N42') THEN TRUE ELSE FALSE END AS prostate_temp,\n    \n    -- Epilepsia\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'G40|G41') THEN TRUE ELSE FALSE END AS epilepsy_temp,\n    \n    -- Doença inflamatória intestinal\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'K50|K51') THEN TRUE ELSE FALSE END AS ibd_temp,\n    \n    -- Bronquiectasia\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'J47') THEN TRUE ELSE FALSE END AS bronchiectasis_temp,\n    \n    -- Leucemias\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'\\bC9[1-5]\\d*\\b') THEN TRUE ELSE FALSE END AS leukemia_temp,\n    \n    -- Linfomas\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'\\bC8[1-6]\\d*\\b|\\bC96\\d*\\b') THEN TRUE ELSE FALSE END AS lymphoma_temp,\n    \n    -- Câncer metastático\n    CASE WHEN REGEXP_CONTAINS(condicoes_ids, r'\\bC7[7-9]\\d*\\b|\\bC80\\d*\\b') THEN TRUE ELSE FALSE END AS metastasis_temp,\n    \n    -- Auxiliares para progressão\n    CASE WHEN ((pressao_sistolica &gt;= 140 AND pressao_sistolica &lt; 180) OR (pressao_diastolica &gt;= 90 AND pressao_diastolica &lt; 110))\n    THEN TRUE ELSE FALSE END AS primeira_medida,\n    \n    -- Contadores\n    ROW_NUMBER() OVER (PARTITION BY cpf ORDER BY entrada_data) AS numero_consulta,\n    SUM(CASE WHEN profissional_especialidade LIKE '%Médico%' THEN 1 ELSE 0 END) \n      OVER (PARTITION BY cpf ORDER BY entrada_data ROWS UNBOUNDED PRECEDING) AS contador_medico,\n    SUM(CASE WHEN profissional_especialidade LIKE '%Enfermeiro%' THEN 1 ELSE 0 END) \n      OVER (PARTITION BY cpf ORDER BY entrada_data ROWS UNBOUNDED PRECEDING) AS contador_enfermeiro,\n    SUM(CASE WHEN ((glicemia &gt;= 100 AND glicemia &lt; 126) OR (hemoglobina_glicada &gt;= 5.7 AND hemoglobina_glicada &lt; 6.5)) THEN 1 ELSE 0 END) \n      OVER (PARTITION BY cpf ORDER BY entrada_data ROWS UNBOUNDED PRECEDING) AS contador_pre_dm,\n    SUM(CASE WHEN (pressao_sistolica &gt; 140 OR pressao_diastolica &gt; 90) THEN 1 ELSE 0 END) \n      OVER (PARTITION BY cpf ORDER BY entrada_data ROWS UNBOUNDED PRECEDING) AS contador_pressao_alta\n  FROM base_dados\n),\n\n-- CTE 4: Ajustes de progressão\ndados_progressao AS (\n  SELECT \n    *,\n    CASE WHEN contador_pre_dm &gt;= 2 THEN TRUE ELSE DM_temp END AS DM_ajustado,\n    CASE WHEN DM_temp = TRUE OR contador_pre_dm &gt;= 2 THEN FALSE ELSE pre_DM_temp END AS pre_DM_ajustado,\n    CASE WHEN contador_pressao_alta &gt;= 2 THEN TRUE ELSE HAS_temp END AS HAS_ajustado,\n    DATE_DIFF(CURRENT_DATE(), data_nascimento, YEAR) AS idade\n  FROM morbidades_temp\n),\n\n-- CTE 5: Persistência das morbidades\ndados_finais AS (\n  SELECT \n    dp.*,\n    hiv.cpf AS hiv_base_cpf,\n    CASE WHEN MAX(CASE WHEN HAS_ajustado THEN 1 ELSE 0 END) \n              OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS HAS,\n    CASE WHEN MAX(CASE WHEN DM_ajustado THEN 1 ELSE 0 END)  \n              OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS DM,\n    CASE WHEN MAX(CASE WHEN pre_DM_ajustado THEN 1 ELSE 0 END) \n              OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS pre_DM,\n    CASE WHEN MAX(CASE WHEN CI_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS CI,\n    CASE WHEN MAX(CASE WHEN ICC_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS ICC,\n    CASE WHEN MAX(CASE WHEN stroke_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS stroke,\n    -- IRC com lógica unificada: CID OU eGFR\n    CASE WHEN (\n      MAX(CASE WHEN IRC_CID_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1\n      OR drc.cpf IS NOT NULL\n      ) THEN TRUE ELSE FALSE END AS IRC,\n    CASE WHEN MAX(CASE WHEN dementia_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS dementia,\n    CASE WHEN MAX(CASE WHEN COPD_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS COPD,\n    CASE WHEN MAX(CASE WHEN peptic_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS peptic,\n    CASE WHEN MAX(CASE WHEN neo_mama_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS neoplasia_mama,\n    CASE WHEN MAX(CASE WHEN neo_colo_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS neoplasia_colo_uterino,\n    CASE WHEN MAX(CASE WHEN neo_fem_estrita_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS neoplasia_feminina_estrita,\n    CASE WHEN MAX(CASE WHEN neo_masc_estrita_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS neoplasia_masculina_estrita,\n    CASE WHEN MAX(CASE WHEN neo_ambos_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS neoplasia_ambos_os_sexos,\n    CASE WHEN MAX(CASE WHEN liver_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS liver,\n    -- HIV/AIDS com lógica unificada: se tem na base HIV OU se apareceu em alguma consulta\n    CASE WHEN (\n      MAX(CASE WHEN SIDA_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1\n      OR hiv.cpf IS NOT NULL\n    ) THEN TRUE ELSE FALSE END AS SIDA,\n    CASE WHEN MAX(CASE WHEN tireoide_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS tireoide,\n    CASE WHEN MAX(CASE WHEN arritmia_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS arritmia,\n    CASE WHEN MAX(CASE WHEN coagulo_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS coagulo,\n    CASE WHEN MAX(CASE WHEN reumato_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS reumato,\n    CASE WHEN MAX(CASE WHEN valvular_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS valvular,\n    CASE WHEN MAX(CASE WHEN circ_pulm_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS circ_pulm,\n    CASE WHEN MAX(CASE WHEN neuro_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS neuro,\n    CASE WHEN MAX(CASE WHEN vascular_periferica_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS vascular_periferica,\n    CASE WHEN MAX(CASE WHEN plegia_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS plegia,\n    CASE WHEN MAX(CASE WHEN dislipidemia_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS dislipidemia,\n    CASE WHEN MAX(CASE WHEN obesidade_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS obesidade,\n    CASE WHEN MAX(CASE WHEN anemias_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS anemias,\n    CASE WHEN MAX(CASE WHEN alcool_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS alcool,\n    CASE WHEN MAX(CASE WHEN drogas_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS drogas,\n    CASE WHEN MAX(CASE WHEN tabaco_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS tabaco,\n    CASE WHEN MAX(CASE WHEN psicoses_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS psicoses,\n    CASE WHEN MAX(CASE WHEN depre_ansiedade_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS depre_ansiedade,\n    CASE WHEN MAX(CASE WHEN desnutricao_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS desnutricao,\n    CASE WHEN MAX(CASE WHEN retardo_mental_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS retardo_mental,\n    CASE WHEN MAX(CASE WHEN descapacidade_motora_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS descapacidade_motora,\n    CASE WHEN MAX(CASE WHEN olhos_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS olhos,\n    CASE WHEN MAX(CASE WHEN ouvidos_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS ouvidos,\n    CASE WHEN MAX(CASE WHEN ma_formacoes_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS ma_formacoes,\n    CASE WHEN MAX(CASE WHEN pele_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS pele,\n    CASE WHEN MAX(CASE WHEN painful_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS painful_condition,\n    CASE WHEN MAX(CASE WHEN asthma_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS asthma,\n    CASE WHEN MAX(CASE WHEN prostate_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS prostate_disorder,\n    CASE WHEN MAX(CASE WHEN epilepsy_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS epilepsy,\n    CASE WHEN MAX(CASE WHEN ibd_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS ibd, \n    CASE WHEN MAX(CASE WHEN bronchiectasis_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS bronchiectasis,\n    CASE WHEN MAX(CASE WHEN leukemia_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS leukemia,\n    CASE WHEN MAX(CASE WHEN lymphoma_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS lymphoma,\n    CASE WHEN MAX(CASE WHEN metastasis_temp THEN 1 ELSE 0 END) OVER (PARTITION BY dp.cpf ORDER BY dp.entrada_data ROWS UNBOUNDED PRECEDING)=1 THEN TRUE ELSE FALSE END AS metastasis\n  \n  FROM dados_progressao dp\n  LEFT JOIN hiv_completo hiv ON dp.cpf = hiv.cpf\n  LEFT JOIN drc_egfr drc ON dp.cpf = drc.cpf\n\n),\n\n-- CTE 6: Cálculo de dias desde última consulta\ndados_com_dias AS (\n  SELECT\n    *,\n    MIN(IF(profissional_especialidade LIKE '%Médico%', entrada_data, NULL)) OVER (PARTITION BY cpf) AS primeira_data_medica,\n    MIN(IF(profissional_especialidade LIKE '%Enfermeiro%', entrada_data, NULL)) OVER (PARTITION BY cpf) AS primeira_data_enfermagem,\n    MAX(IF(profissional_especialidade LIKE '%Médico%', entrada_data, NULL)) OVER (PARTITION BY cpf ORDER BY entrada_data ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS data_medica_ant,\n    MAX(IF(profissional_especialidade LIKE '%Enfermeiro%', entrada_data, NULL)) OVER (PARTITION BY cpf ORDER BY entrada_data ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS data_enfermagem_ant\n  FROM dados_finais\n),\n\ndados_com_dias_calc AS (\n  SELECT\n    *,\n    CASE \n      WHEN primeira_data_medica IS NULL THEN 9999\n      WHEN profissional_especialidade LIKE '%Médico%' THEN DATE_DIFF(CURRENT_DATE(), entrada_data, DAY)\n      WHEN data_medica_ant IS NOT NULL THEN DATE_DIFF(CURRENT_DATE(), data_medica_ant, DAY)\n      ELSE 9999\n    END AS dias_ultima_medica,\n    CASE \n      WHEN primeira_data_enfermagem IS NULL THEN 9999\n      WHEN profissional_especialidade LIKE '%Enfermeiro%' THEN DATE_DIFF(CURRENT_DATE(), entrada_data, DAY)\n      WHEN data_enfermagem_ant IS NOT NULL THEN DATE_DIFF(CURRENT_DATE(), data_enfermagem_ant, DAY)\n      ELSE 9999\n    END AS dias_ultima_enfermagem\n  FROM dados_com_dias\n),\n\n-- CTE 7: Última observação por CPF\nultima_observacao AS (\n  SELECT \n    *,\n    ROW_NUMBER() OVER (PARTITION BY cpf ORDER BY entrada_data DESC, id_hci DESC) AS rn_ultima\n  FROM dados_com_dias_calc\n),\n\n-- ============================================\n-- CTEs DE MEDICAMENTOS (da query mantidos_alterados.sql)\n-- ============================================\n\nbase_episodios_med AS (\n    SELECT \n        id_hci, \n        paciente.cpf as paciente_cpf,\n        entrada_data\n    FROM `rj-sms.saude_historico_clinico.episodio_assistencial`\n    WHERE paciente.cpf IS NOT NULL\n),\n\ndados_unidos_med AS (\n    SELECT \n        ep.paciente_cpf,\n        ep.entrada_data,\n        ep.id_hci,\n        JSON_EXTRACT_SCALAR(prescricao, '$.nome_medicamento') as medicamento_original,\n        JSON_EXTRACT_SCALAR(prescricao, '$.posologia') as posologia_original,\n        \n        CASE\n            WHEN REGEXP_CONTAINS(UPPER(COALESCE(JSON_EXTRACT_SCALAR(prescricao, '$.posologia'), '')), \n                r'1.*COMP.*(MANH|DIA|JEJUM|24.*H)|UM.*COMP.*(MANH|DIA|JEJUM)|01.*COMP') \n                THEN '1X/DIA'\n            WHEN REGEXP_CONTAINS(UPPER(COALESCE(JSON_EXTRACT_SCALAR(prescricao, '$.posologia'), '')), \n                r'02.*COMP.*12.*12|2.*COMP.*12.*12|DOIS.*COMP.*12.*12') \n                THEN '2X/DIA'\n            WHEN REGEXP_CONTAINS(UPPER(COALESCE(JSON_EXTRACT_SCALAR(prescricao, '$.posologia'), '')), \n                r'1.*COMP.*12.*12|UM.*COMP.*12.*12|01.*COMP.*12.*12') \n                THEN '2X/DIA'\n            WHEN REGEXP_CONTAINS(UPPER(COALESCE(JSON_EXTRACT_SCALAR(prescricao, '$.posologia'), '')), \n                r'1.*COMP.*8.*8|UM.*COMP.*8.*8') \n                THEN '3X/DIA'\n            WHEN REGEXP_CONTAINS(UPPER(COALESCE(JSON_EXTRACT_SCALAR(prescricao, '$.posologia'), '')), \n                r'2.*COMP.*NOITE') \n                THEN '2X/NOITE'\n            ELSE UPPER(COALESCE(JSON_EXTRACT_SCALAR(prescricao, '$.posologia'), 'SEM_POSOLOGIA'))\n        END as posologia_normalizada,\n        \n        CASE\n            WHEN JSON_EXTRACT_SCALAR(prescricao, '$.uso_continuado') = 'false' THEN 'AGUDO'\n            WHEN JSON_EXTRACT_SCALAR(prescricao, '$.uso_continuado') = 'true' THEN 'CRONICO'\n            ELSE 'CRONICO'\n        END as tipo_medicamento\n        \n    FROM `rj-sms.brutos_prontuario_vitacare.atendimento` AS atend,\n    UNNEST(JSON_EXTRACT_ARRAY(atend.prescricoes)) as prescricao\n    INNER JOIN base_episodios_med ep ON atend.id_hci = ep.id_hci\n    WHERE JSON_EXTRACT_SCALAR(prescricao, '$.nome_medicamento') IS NOT NULL\n),\n\nmedicamentos_por_cpf AS (\n    SELECT \n        paciente_cpf,\n        STRING_AGG(\n            CASE WHEN tipo_medicamento = 'CRONICO' \n            THEN CONCAT(medicamento_original, ' - ', posologia_normalizada)\n            END, \n            '; ' \n            ORDER BY medicamento_original\n        ) as medicamentos_cronicos_normalizados,\n        COUNTIF(tipo_medicamento = 'CRONICO') as qtd_cronicos\n    FROM dados_unidos_med\n    WHERE paciente_cpf IN (SELECT DISTINCT cpf FROM ultima_observacao WHERE rn_ultima = 1)\n    GROUP BY paciente_cpf\n),\n\nultima_prescricao_por_cpf AS (\n    SELECT \n        paciente_cpf,\n        MAX(entrada_data) as data_ultima_prescricao\n    FROM dados_unidos_med\n    WHERE tipo_medicamento = 'CRONICO'\n    GROUP BY paciente_cpf\n),\n\nmedicamentos_ultima_data AS (\n    SELECT \n        med.paciente_cpf,\n        up.data_ultima_prescricao,\n        STRING_AGG(\n            CASE WHEN med.tipo_medicamento = 'CRONICO' \n            THEN CONCAT(med.medicamento_original, ' - ', med.posologia_normalizada)\n            END, \n            '; ' \n            ORDER BY med.medicamento_original\n        ) as medicamentos_cronicos_normalizados,\n        COUNTIF(med.tipo_medicamento = 'CRONICO') as qtd_cronicos\n    FROM dados_unidos_med med\n    INNER JOIN ultima_prescricao_por_cpf up\n        ON med.paciente_cpf = up.paciente_cpf\n        AND med.entrada_data = up.data_ultima_prescricao\n    WHERE med.tipo_medicamento = 'CRONICO'\n    GROUP BY med.paciente_cpf, up.data_ultima_prescricao\n),\n\n-- CTE 8: Cálculo do número de morbidades\nN_morbidades_calc AS (\n  SELECT \n    *,\n    (\n     CASE WHEN HAS THEN 1 ELSE 0 END +\n     CASE WHEN DM THEN 1 ELSE 0 END +\n     CASE WHEN CI THEN 1 ELSE 0 END +\n     CASE WHEN ICC THEN 1 ELSE 0 END +\n     CASE WHEN stroke THEN 1 ELSE 0 END +\n     CASE WHEN IRC THEN 1 ELSE 0 END +\n     CASE WHEN dementia THEN 1 ELSE 0 END +\n     CASE WHEN COPD THEN 1 ELSE 0 END +\n     CASE WHEN peptic THEN 1 ELSE 0 END +\n     CASE WHEN neoplasia_mama THEN 1 ELSE 0 END +\n     CASE WHEN neoplasia_colo_uterino THEN 1 ELSE 0 END +\n     CASE WHEN neoplasia_feminina_estrita THEN 1 ELSE 0 END +\n     CASE WHEN neoplasia_masculina_estrita THEN 1 ELSE 0 END +\n     CASE WHEN neoplasia_ambos_os_sexos THEN 1 ELSE 0 END +\n     CASE WHEN liver THEN 1 ELSE 0 END +\n     CASE WHEN SIDA THEN 1 ELSE 0 END +\n     CASE WHEN tireoide THEN 1 ELSE 0 END +\n     CASE WHEN arritmia THEN 1 ELSE 0 END +\n     CASE WHEN coagulo THEN 1 ELSE 0 END +\n     CASE WHEN reumato THEN 1 ELSE 0 END +\n     CASE WHEN valvular THEN 1 ELSE 0 END +\n     CASE WHEN circ_pulm THEN 1 ELSE 0 END +\n     CASE WHEN neuro THEN 1 ELSE 0 END +\n     CASE WHEN vascular_periferica THEN 1 ELSE 0 END +\n     CASE WHEN plegia THEN 1 ELSE 0 END +\n     CASE WHEN obesidade THEN 1 ELSE 0 END +\n     CASE WHEN anemias THEN 1 ELSE 0 END +\n     CASE WHEN alcool THEN 1 ELSE 0 END +\n     CASE WHEN drogas THEN 1 ELSE 0 END +\n     CASE WHEN psicoses THEN 1 ELSE 0 END +\n     CASE WHEN desnutricao THEN 1 ELSE 0 END +\n     CASE WHEN retardo_mental THEN 1 ELSE 0 END +\n     CASE WHEN olhos THEN 1 ELSE 0 END +\n     CASE WHEN ouvidos THEN 1 ELSE 0 END +\n     CASE WHEN painful_condition THEN 1 ELSE 0 END +\n     CASE WHEN asthma THEN 1 ELSE 0 END +\n     CASE WHEN prostate_disorder THEN 1 ELSE 0 END + \n     CASE WHEN bronchiectasis THEN 1 ELSE 0 END\n    ) AS N_morbidades\n  FROM ultima_observacao\n  WHERE rn_ultima = 1\n)\n\n-- ============================================\n-- SELECT FINAL\n-- ============================================\nSELECT \n  u.area_programatica AS cod_area,\n  u.clinica_familia,\n  u.ESF,\n  u.cpf,\n  u.id_paciente,\n  u.genero AS sexo,\n  u.idade,\n  CASE \n    WHEN u.idade &lt; 5 THEN '0-4'\n    WHEN u.idade BETWEEN 5 AND 9 THEN '5-9'\n    WHEN u.idade BETWEEN 10 AND 14 THEN '10-14'\n    WHEN u.idade BETWEEN 15 AND 19 THEN '15-19'\n    WHEN u.idade BETWEEN 20 AND 24 THEN '20-24'\n    WHEN u.idade BETWEEN 25 AND 29 THEN '25-29'\n    WHEN u.idade BETWEEN 30 AND 34 THEN '30-34'\n    WHEN u.idade BETWEEN 35 AND 39 THEN '35-39'\n    WHEN u.idade BETWEEN 40 AND 44 THEN '40-44'\n    WHEN u.idade BETWEEN 45 AND 49 THEN '45-49'\n    WHEN u.idade BETWEEN 50 AND 54 THEN '50-54'\n    WHEN u.idade BETWEEN 55 AND 59 THEN '55-59'\n    WHEN u.idade BETWEEN 60 AND 64 THEN '60-64'\n    WHEN u.idade BETWEEN 65 AND 69 THEN '65-69'\n    WHEN u.idade BETWEEN 70 AND 74 THEN '70-74'\n    WHEN u.idade BETWEEN 75 AND 79 THEN '75-79'\n    WHEN u.idade BETWEEN 80 AND 84 THEN '80-84'\n    WHEN u.idade BETWEEN 85 AND 89 THEN '85-89'\n    WHEN u.idade &gt;= 90 THEN '90+'\n    ELSE NULL\n  END AS grupo_etario,\n  \n  -- Morbidades\n  u.HAS,\n  u.DM,\n  u.pre_DM,\n  u.CI,\n  u.ICC,\n  u.stroke,\n  u.IRC,\n  u.dementia,\n  u.COPD,\n  u.peptic,\n  u.neoplasia_mama,\n  u.neoplasia_colo_uterino,\n  u.neoplasia_feminina_estrita,\n  u.neoplasia_masculina_estrita,\n  u.neoplasia_ambos_os_sexos,\n  u.liver,\n  u.SIDA,\n  u.tireoide,\n  u.arritmia,\n  u.coagulo,\n  u.reumato,\n  u.circ_pulm,\n  u.neuro,\n  u.vascular_periferica,\n  u.plegia,\n  u.dislipidemia,\n  u.obesidade,\n  u.anemias,\n  u.alcool,\n  u.drogas,\n  u.tabaco,\n  u.psicoses,\n  u.depre_ansiedade,\n  u.desnutricao,\n  u.retardo_mental,\n  u.descapacidade_motora,\n  u.olhos,\n  u.ouvidos,\n  u.ma_formacoes,\n  u.pele,\n  u.painful_condition,\n  u.asthma,\n  u.prostate_disorder,\n  u.epilepsy,\n  u.ibd,\n  u.bronchiectasis,\n  u.leukemia,\n  u.lymphoma,\n  u.metastasis,\n  \n  u.N_morbidades,\n  \n  -- Lista de morbidades\n  (\n    SELECT STRING_AGG(x, ', ')\n    FROM UNNEST([\n      IF(u.HAS, 'Hipertensão Arterial', NULL),\n      IF(u.DM,  'Diabetes Mellitus', NULL),\n      IF(u.pre_DM, 'Pré-diabetes', NULL),\n      IF(u.CI, 'Cardiopatia Isquêmica', NULL),\n      IF(u.ICC, 'Insuficiência Cardíaca', NULL),\n      IF(u.stroke, 'AVC', NULL),\n      IF(u.IRC, 'Insuficiência Renal Crônica', NULL),\n      IF(u.dementia, 'Demência', NULL),\n      IF(u.COPD, 'DPOC', NULL),\n      IF(u.peptic, 'Úlcera Péptica', NULL),\n      IF(u.neoplasia_mama, 'Neoplasia de Mama', NULL),\n      IF(u.neoplasia_colo_uterino, 'Neoplasia de Colo do Útero', NULL),\n      IF(u.neoplasia_feminina_estrita, 'Neoplasia Feminina (exceto mama/colo)', NULL),\n      IF(u.neoplasia_masculina_estrita, 'Neoplasia Masculina', NULL),\n      IF(u.neoplasia_ambos_os_sexos, 'Neoplasia (ambos os sexos)', NULL),\n      IF(u.liver, 'Doença Hepática', NULL),\n      IF(u.SIDA, 'HIV/AIDS', NULL),\n      IF(u.tireoide, 'Doenças da Tireoide', NULL),\n      IF(u.arritmia, 'Arritmia', NULL),\n      IF(u.coagulo, 'Distúrbio de Coagulação', NULL),\n      IF(u.reumato, 'Doença Reumatológica', NULL),\n      IF(u.valvular, 'Doença Valvular', NULL),\n      IF(u.circ_pulm, 'Doença Circulatória Pulmonar', NULL),\n      IF(u.neuro, 'Doença Neurológica', NULL),\n      IF(u.vascular_periferica, 'Doença Vascular Periférica', NULL),\n      IF(u.plegia, 'Plegia', NULL),\n      IF(u.dislipidemia, 'Dislipidemia', NULL),\n      IF(u.obesidade, 'Obesidade', NULL),\n      IF(u.anemias, 'Anemia', NULL),\n      IF(u.alcool, 'Transtorno por Uso de Álcool', NULL),\n      IF(u.drogas, 'Transtorno por Uso de Drogas', NULL),\n      IF(u.tabaco, 'Tabagismo', NULL),\n      IF(u.psicoses, 'Psicose', NULL),\n      IF(u.depre_ansiedade, 'Depressão e Ansiedade', NULL),\n      IF(u.desnutricao, 'Desnutrição', NULL),\n      IF(u.retardo_mental, 'Deficiência Intelectual', NULL),\n      IF(u.descapacidade_motora, 'Deficiência Motora', NULL),\n      IF(u.olhos, 'Doença Ocular', NULL),\n      IF(u.ouvidos, 'Perda de audição', NULL),\n      IF(u.ma_formacoes, 'Malformação Congênita', NULL),\n      IF(u.pele, 'Doença de Pele', NULL),\n      IF(u.painful_condition, 'Condição Dolorosa Crônica', NULL),\n      IF(u.asthma, 'Asma', NULL),\n      IF(u.prostate_disorder, 'Doença da Próstata', NULL),\n      IF(u.epilepsy, 'Epilepsia', NULL),\n      IF(u.ibd, 'Doença Inflamatória Intestinal', NULL),\n      IF(u.bronchiectasis, 'Bronquiectasia', NULL),\n      IF(u.leukemia, 'Leucemia', NULL),\n      IF(u.lymphoma, 'Linfoma', NULL),\n      IF(u.metastasis, 'Câncer Metastático', NULL)\n    ]) AS x\n    WHERE x IS NOT NULL\n  ) AS lista_morbidades,\n  \n  -- Medicamentos crônicos\n  med.medicamentos_cronicos_normalizados,\n  med.qtd_cronicos AS qtd_medicamentos_cronicos,\n  \n  -- Polifarmácia\n  CASE WHEN COALESCE(med.qtd_cronicos, 0) &gt;= 5 THEN TRUE ELSE FALSE END AS polifarmacia,\n  CASE WHEN COALESCE(med.qtd_cronicos, 0) &gt;= 10 THEN TRUE ELSE FALSE END AS hiperpolifarmacia,\n  \n  -- Dias desde últimas consultas\n  u.dias_ultima_medica,\n  u.dias_ultima_enfermagem,\n  \n  CURRENT_DATE() AS data_extracao\n\nFROM N_morbidades_calc u\nLEFT JOIN medicamentos_ultima_data med ON u.cpf = med.paciente_cpf\nORDER BY u.area_programatica, u.clinica_familia, u.ESF, u.cpf",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Tabela Fato pacientes - Morbidades e fármacos de uso crônico para cada paciente</span>"
    ]
  },
  {
    "objectID": "summary.html",
    "href": "summary.html",
    "title": "2  Morbidades agregadas",
    "section": "",
    "text": "Abaixo está a query com as informações agregadas seguindo a seguinte estrutura hierárquica:\nÁrea Programática\nClínica da Família\nESF\nsexo\nGrupo etário (5 anos)\nEsta tabela apresenta valores absolutos e prevalências para população geral, cada morbidade, multimorbidade, polifarmácia e hiperpolifarmácia. Também apresenta algumas informações sumárias como média de morbidades e média de medicamentos prescritos.\nA tabela Morbidades agregadas está aqui - rj-sms-sandbox.sub_pav_us.morbidades_agregadas\n\n#| eval: false   # não executa\n#| echo: true    # exibe o código\n#| include: true # garante que o chunk aparece no documento\n\n\n-- ============================================\n-- AGREGAÇÃO DE MORBIDADES POR ESTRUTURA HIERÁRQUICA\n-- Área Programática &gt; Clínica &gt; ESF &gt; Sexo &gt; Grupo Etário\n-- ============================================\n\n\n\nSELECT \n  cod_area,\n  clinica_familia,\n  ESF,\n  sexo,\n  grupo_etario,\n  \n  -- Total de pacientes\n  COUNT(DISTINCT cpf) AS total_pacientes,\n  \n  -- Morbidades principais\n  COUNTIF(HAS = TRUE) AS n_hipertensao,\n  COUNTIF(DM = TRUE) AS n_diabetes,\n  COUNTIF(pre_DM = TRUE) AS n_pre_diabetes,\n  COUNTIF(CI = TRUE) AS n_cardiopatia_isquemica,\n  COUNTIF(ICC = TRUE) AS n_insuficiencia_cardiaca,\n  COUNTIF(stroke = TRUE) AS n_avc,\n  COUNTIF(IRC = TRUE) AS n_doenca_renal_cronica,\n  COUNTIF(dementia = TRUE) AS n_demencia,\n  COUNTIF(COPD = TRUE) AS n_dpoc,\n  COUNTIF(peptic = TRUE) AS n_ulcera_peptica,\n  \n  -- Neoplasias\n  COUNTIF(neoplasia_mama = TRUE) AS n_neoplasia_mama,\n  COUNTIF(neoplasia_colo_uterino = TRUE) AS n_neoplasia_colo_uterino,\n  COUNTIF(neoplasia_feminina_estrita = TRUE) AS n_neoplasia_feminina_estrita,\n  COUNTIF(neoplasia_masculina_estrita = TRUE) AS n_neoplasia_masculina_estrita,\n  COUNTIF(neoplasia_ambos_os_sexos = TRUE) AS n_neoplasia_ambos_sexos,\n  COUNTIF(leukemia = TRUE) AS n_leucemia,\n  COUNTIF(lymphoma = TRUE) AS n_linfoma,\n  COUNTIF(metastasis = TRUE) AS n_cancer_metastatico,\n  \n  -- Outras morbidades crônicas\n  COUNTIF(liver = TRUE) AS n_doenca_hepatica,\n  COUNTIF(SIDA = TRUE) AS n_hiv_aids,\n  COUNTIF(arritmia = TRUE) AS n_arritmia,\n  COUNTIF(coagulo = TRUE) AS n_disturbio_coagulacao,\n  COUNTIF(reumato = TRUE) AS n_doenca_reumatologica,\n  COUNTIF(circ_pulm = TRUE) AS n_doenca_circulatoria_pulmonar,\n  COUNTIF(neuro = TRUE) AS n_doenca_neurologica,\n  COUNTIF(vascular_periferica = TRUE) AS n_doenca_vascular_periferica,\n  COUNTIF(plegia = TRUE) AS n_plegia,\n  COUNTIF(dislipidemia = TRUE) AS n_dislipidemia,\n  COUNTIF(obesidade = TRUE) AS n_obesidade,\n  COUNTIF(anemias = TRUE) AS n_anemias,\n  \n  -- Saúde mental e uso de substâncias\n  COUNTIF(alcool = TRUE) AS n_transtorno_alcool,\n  COUNTIF(drogas = TRUE) AS n_transtorno_drogas,\n  COUNTIF(tabaco = TRUE) AS n_tabagismo,\n  COUNTIF(psicoses = TRUE) AS n_psicoses,\n  COUNTIF(depre_ansiedade = TRUE) AS n_depressao_ansiedade,\n  \n  -- Outras condições\n  COUNTIF(desnutricao = TRUE) AS n_desnutricao,\n  COUNTIF(retardo_mental = TRUE) AS n_deficiencia_intelectual,\n  COUNTIF(descapacidade_motora = TRUE) AS n_deficiencia_motora,\n  COUNTIF(olhos = TRUE) AS n_doenca_ocular,\n  COUNTIF(ouvidos = TRUE) AS n_perda_audicao,\n  COUNTIF(ma_formacoes = TRUE) AS n_malformacao_congenita,\n  COUNTIF(pele = TRUE) AS n_doenca_pele,\n  \n  -- Condições adicionais (SNOMED)\n  COUNTIF(painful_condition = TRUE) AS n_condicao_dolorosa_cronica,\n  COUNTIF(asthma = TRUE) AS n_asma,\n  COUNTIF(prostate_disorder = TRUE) AS n_doenca_prostata,\n  COUNTIF(epilepsy = TRUE) AS n_epilepsia,\n  COUNTIF(ibd = TRUE) AS n_doenca_inflamatoria_intestinal,\n  COUNTIF(bronchiectasis = TRUE) AS n_bronquiectasia,\n  \n  -- Indicadores de multimorbidade\n  COUNTIF(N_morbidades = 0) AS n_sem_morbidades,\n  COUNTIF(N_morbidades = 1) AS n_1_morbidade,\n  COUNTIF(N_morbidades = 2) AS n_2_morbidades,\n  COUNTIF(N_morbidades = 3) AS n_3_morbidades,\n  COUNTIF(N_morbidades = 4) AS n_4_morbidades,\n  COUNTIF(N_morbidades = 5) AS n_5_morbidades,\n  COUNTIF(N_morbidades &gt;= 6) AS n_6_ou_mais_morbidades,\n  COUNTIF(N_morbidades &gt;= 2) AS n_multimorbidade,\n  \n  -- Estatísticas de morbidades\n  ROUND(AVG(N_morbidades), 2) AS media_morbidades,\n  APPROX_QUANTILES(N_morbidades, 100)[OFFSET(50)] AS mediana_morbidades,\n  MIN(N_morbidades) AS min_morbidades,\n  MAX(N_morbidades) AS max_morbidades,\n  \n  -- Polifarmácia\n  COUNTIF(polifarmacia = TRUE) AS n_polifarmacia,\n  COUNTIF(hiperpolifarmacia = TRUE) AS n_hiperpolifarmacia,\n  COUNTIF(qtd_medicamentos_cronicos = 0) AS n_sem_medicamentos,\n  COUNTIF(qtd_medicamentos_cronicos BETWEEN 1 AND 4) AS n_1_a_4_medicamentos,\n  COUNTIF(qtd_medicamentos_cronicos BETWEEN 5 AND 9) AS n_5_a_9_medicamentos,\n  COUNTIF(qtd_medicamentos_cronicos &gt;= 10) AS n_10_ou_mais_medicamentos,\n  \n  -- Estatísticas de medicamentos\n  ROUND(AVG(COALESCE(qtd_medicamentos_cronicos, 0)), 2) AS media_medicamentos,\n  APPROX_QUANTILES(COALESCE(qtd_medicamentos_cronicos, 0), 100)[OFFSET(50)] AS mediana_medicamentos,\n  MAX(qtd_medicamentos_cronicos) AS max_medicamentos,\n  \n  -- Prevalências (%)\n  ROUND(COUNTIF(HAS = TRUE) * 100.0 / COUNT(DISTINCT cpf), 2) AS prevalencia_hipertensao,\n  ROUND(COUNTIF(DM = TRUE) * 100.0 / COUNT(DISTINCT cpf), 2) AS prevalencia_diabetes,\n  ROUND(COUNTIF(N_morbidades &gt;= 2) * 100.0 / COUNT(DISTINCT cpf), 2) AS prevalencia_multimorbidade,\n  ROUND(COUNTIF(polifarmacia = TRUE) * 100.0 / COUNT(DISTINCT cpf), 2) AS prevalencia_polifarmacia,\n  ROUND(COUNTIF(hiperpolifarmacia = TRUE) * 100.0 / COUNT(DISTINCT cpf), 2) AS prevalencia_hiperpolifarmacia,\n  \n  -- Acompanhamento\n  ROUND(AVG(dias_ultima_medica), 1) AS media_dias_ultima_consulta_medica,\n  ROUND(AVG(dias_ultima_enfermagem), 1) AS media_dias_ultima_consulta_enfermagem,\n  COUNTIF(dias_ultima_medica &lt;= 180) AS n_consulta_medica_6_meses,\n  COUNTIF(dias_ultima_medica &lt;= 365) AS n_consulta_medica_12_meses,\n  COUNTIF(dias_ultima_enfermagem &lt;= 180) AS n_consulta_enfermagem_6_meses,\n  COUNTIF(dias_ultima_enfermagem &lt;= 365) AS n_consulta_enfermagem_12_meses\n\nFROM `rj-sms-sandbox.sub_pav_us.morbidades_20251015`\n\nGROUP BY \n  cod_area,\n  clinica_familia,\n  ESF,\n  sexo,\n  grupo_etario\n\nORDER BY \n  cod_area,\n  clinica_familia,\n  ESF,\n  sexo,\n  grupo_etario;",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Morbidades agregadas</span>"
    ]
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "A tabela morbidades está aqui - rj-sms-sandbox.sub_pav_us.morbidades_20251015\nA tabela Morbidades agregadas está aqui - rj-sms-sandbox.sub_pav_us.morbidades_agregadas\n\nPasso a passo para organização dos dados e tabelas",
    "crumbs": [
      "References"
    ]
  },
  {
    "objectID": "docu_enxuto.html",
    "href": "docu_enxuto.html",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "",
    "text": "3.1 Visão Geral",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#visão-geral",
    "href": "docu_enxuto.html#visão-geral",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "",
    "text": "3.1.1 Objetivo\nA tabela rj-sms-sandbox.sub_pav_us.MM_exames_e_risco_A1C é a tabela fato principal do Navegador Clínico de Multimorbidade. Consolida dados de múltiplas fontes em uma linha por paciente (CPF), integrando:\n\nDados demográficos e de cadastro na ESF\n56 morbidades identificadas por CID\nDiagnósticos expandidos de HAS e DM (CID + medidas + medicamentos)\nExames laboratoriais e medidas antropométricas\nCálculos de risco cardiovascular (Framingham + estratificação SBC)\nÍndice de Charlson modificado\nHistórico de controle de condições crônicas\nMais de 30 lacunas de cuidado identificadas\n\n\n\n3.1.2 Localização\nProjeto: rj-sms-sandbox\nDataset: sub_pav_us\nTabela: MM_exames_e_risco_A1C\n\n\n3.1.3 Granularidade\n1 linha por CPF - cada paciente aparece uma única vez na tabela final.\n\n\n3.1.4 Critérios de Inclusão\n\nCPF válido (não nulo)\nSem indicador de óbito (obito_indicador = FALSE)\nSem data de óbito (obito_data IS NULL)\nCadastrado em ESF (não ESB - Equipe de Saúde Bucal)\nINE de cadastro não nulo",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#arquitetura-de-dados",
    "href": "docu_enxuto.html#arquitetura-de-dados",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.2 Arquitetura de Dados",
    "text": "3.2 Arquitetura de Dados\n\n3.2.1 Fluxo Geral das CTEs\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                           FONTES DE DADOS                                    │\n├─────────────────────────────────────────────────────────────────────────────┤\n│ • brutos_prontuario_vitacare_historico.hiv                                  │\n│ • brutos_prontuario_vitacare_historico.acto                                 │\n│ • saude_historico_clinico.episodio_assistencial                             │\n│ • saude_historico_clinico.exame                                             │\n│ • saude_historico_clinico.paciente                                          │\n│ • brutos_cientificalab.solicitacoes/exames/resultados                       │\n│ • brutos_prontuario_vitacare.atendimento                                    │\n│ • sub_pav_us.indicadores_vitacare_fix (tabela auxiliar com correções)       │\n│ • sub_pav_us.PA_A1C_glic_cpf_fix (tabela auxiliar com correções)            │\n│ • sub_pav_us.MM_mantidos_alterados_ultimas (medicamentos crônicos)          │\n│ • saude_dados_mestres.estabelecimento                                       │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                        SEÇÃO 1: HIV/AIDS                                     │\n│  hiv_cpf_raw → hiv_cpf → exames_hiv_cpf_raw → exames_hiv_cpf_last           │\n│                       → hiv_completo                                         │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                   SEÇÃO 2: EXAMES LABORATORIAIS                              │\n│  exames_historico ─┐                                                         │\n│  exames_cientifica ┼→ todos_exames → exames_filtrados → exames_mais_recentes │\n│                    │                                  → exames_pivot          │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                   SEÇÃO 3: DADOS DEMOGRÁFICOS                                │\n│                        dados_paciente                                        │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                SEÇÃO 4: MEDIDAS ANTROPOMÉTRICAS                              │\n│                 ultimas_medidas_antropometricas                              │\n│            (fontes: indicadores_vitacare_fix + episodio)                     │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                   SEÇÃO 5: MORBIDADES POR CID                                │\n│              morbidades_base → morbidades_por_cid                            │\n│                    (56 condições clínicas)                                   │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│              SEÇÃO 5B: CRITÉRIOS EXPANDIDOS HAS                              │\n│  todas_medidas_pa → criterios_has_medidas                                    │\n│                   → criterios_has_medicamentos                               │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│              SEÇÃO 5C: CRITÉRIOS EXPANDIDOS DM                               │\n│  todas_medidas_glicemia → criterios_dm_medidas                               │\n│                         → criterios_dm_medicamentos                          │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│              SEÇÃO 5D: CONSOLIDAÇÃO HAS + DM                                 │\n│                      has_dm_consolidado                                      │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│              SEÇÃO 5E: PROGRESSÃO GLICÊMICA                                  │\n│  hba1c_progressao → progressao_glicemica                                     │\n│  historico_controle_glicemia → resumo_controle_glicemia                      │\n│  ultimas_medidas_glicemia                                                    │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│              SEÇÃO 5F: PROGRESSÃO PRESSÓRICA                                 │\n│  todas_medidas_pa_completas → pa_progressao → progressao_pressao             │\n│  historico_controle_pa → resumo_controle_pa                                  │\n│  ultimas_medidas_pa                                                          │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                   SEÇÃO 6: CONSULTAS                                         │\n│  contagem_consultas_detalhada → intervalos_consultas → contagem_consultas    │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│              SEÇÃO 7: CONSOLIDAÇÃO COM eGFR                                  │\n│  dados_consolidados (JOIN de todas as CTEs anteriores)                       │\n│  + Cálculo CKD-EPI 2021 + Estadiamento CKD                                   │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│           SEÇÃO 7A: MORBIDADES CONSOLIDADAS                                  │\n│  dados_com_irc → dados_com_hiv → dados_com_dislipidemia                      │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│           SEÇÃO 7B: MULTIMORBIDADE                                           │\n│  morbidades_array → dados_com_multimorbidade                                 │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│           SEÇÃO 9: FRAMINGHAM                                                │\n│  pontuacao_framingham → risco_calculado                                      │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│           SEÇÃO 10: RISCO CARDIOVASCULAR SBC                                 │\n│               risco_cardiovascular_estratificado                             │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│           SEÇÃO 11: CHARLSON INDEX                                           │\n│  charlson_componentes → charlson_final                                       │\n│  (inclui JOIN com MM_mantidos_alterados_ultimas para polifarmácia)           │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│           BENCHMARK DE CONSULTAS                                             │\n│               benchmark_consultas                                            │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                      SELECT FINAL                                            │\n│  • Todos os campos consolidados                                              │\n│  • Lacunas de cuidado calculadas                                             │\n│  • Flags de inequidade                                                       │\n│  • Ordenação por risco cardiovascular                                        │\n└─────────────────────────────────────────────────────────────────────────────┘",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-1-identificação-de-hivaids",
    "href": "docu_enxuto.html#seção-1-identificação-de-hivaids",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.3 Seção 1: Identificação de HIV/AIDS",
    "text": "3.3 Seção 1: Identificação de HIV/AIDS\n\n3.3.1 Objetivo Clínico\nIdentificar pacientes com HIV/AIDS utilizando duas fontes complementares: 1. Base específica de HIV do Vitacare (registro histórico) 2. Exames de CD4 e carga viral do episódio assistencial\n\n\n3.3.2 CTEs Envolvidas\n\n3.3.2.1 hiv_cpf_raw\nFonte: brutos_prontuario_vitacare_historico.hiv + brutos_prontuario_vitacare_historico.acto\nObjetivo: Extrair CPFs de pacientes com registro na base de HIV do Vitacare.\nCampos capturados: - id_prontuario_global: Identificador do prontuário - id_cnes: Unidade de saúde - ano_diagnostico: Ano do diagnóstico de AIDS (campo aids_doenca_atual_ano_1_teste) - cpf: CPF limpo (apenas dígitos, via REGEXP_REPLACE)\nRegra de negócio: Remove caracteres não numéricos do CPF.\n\n\n3.3.2.2 hiv_cpf\nObjetivo: Deduplica a CTE anterior, mantendo apenas CPFs com 11 dígitos.\nRegra de deduplicação: ROW_NUMBER() OVER (PARTITION BY cpf ORDER BY id_prontuario_global DESC) - mantém o registro mais recente por prontuário.\n\n\n3.3.2.3 exames_hiv_cpf_raw\nFonte: saude_historico_clinico.episodio_assistencial (campo exames_realizados)\nObjetivo: Identificar pacientes com exames de CD4 ou carga viral, indicativos de HIV.\nPadrão REGEX utilizado:\nREGEXP_CONTAINS(er.descricao, r'(?i)\\b(cd4|cv|carga viral)\\b')\nCampos capturados: - id_hci: ID do episódio - entrada_data: Data do exame - tipo, descricao: Detalhes do exame - cpf: CPF limpo\n\n\n3.3.2.4 exames_hiv_cpf_last\nObjetivo: Mantém apenas o exame mais recente por CPF.\nRegra de deduplicação: ORDER BY entrada_data DESC, id_hci DESC\n\n\n3.3.2.5 hiv_completo\nObjetivo: Consolida as duas fontes de HIV em uma única CTE.\nCampos produzidos: | Campo | Tipo | Descrição | |——-|——|———–| | cpf | STRING | CPF do paciente | | id_prontuario_global | STRING | ID do prontuário Vitacare | | id_cnes | STRING | Unidade onde foi registrado | | ano_diagnostico | STRING | Ano do diagnóstico de AIDS | | data_ultimo_exame_hiv | DATE | Data do último CD4/CV | | data_diagnostico_hiv | DATE | Ano convertido para DATE (01/01/ano) |\nValidação do ano de diagnóstico:\nSAFE_CAST(ano_diagnostico AS INT64) &gt;= 1980  -- HIV surgiu nos anos 80\nSAFE_CAST(ano_diagnostico AS INT64) &lt;= EXTRACT(YEAR FROM CURRENT_DATE())\n\n\n\n3.3.3 Uso no Dashboard\n\nIdentificação de pacientes com HIV para acompanhamento diferenciado\nCálculo de multimorbidade (HIV conta como uma morbidade)\nLacunas de cuidado específicas para PVHIV",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-2-exames-laboratoriais",
    "href": "docu_enxuto.html#seção-2-exames-laboratoriais",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.4 Seção 2: Exames Laboratoriais",
    "text": "3.4 Seção 2: Exames Laboratoriais\n\n3.4.1 Objetivo Clínico\nConsolidar resultados de exames laboratoriais de múltiplas fontes, mantendo apenas o resultado mais recente de cada tipo de exame por paciente.\n\n\n3.4.2 Exames Capturados\n\n\n\nCódigo\nExame\nFaixa Válida\nUnidade\n\n\n\n\nCRE\nCreatinina\n0.2 - 15\nmg/dL\n\n\nCOL\nColesterol Total\n50 - 600\nmg/dL\n\n\nHDL\nHDL-Colesterol\n10 - 150\nmg/dL\n\n\nLDL\nLDL-Colesterol\n20 - 400\nmg/dL\n\n\nTRI\nTriglicerídeos\n20 - 1000\nmg/dL\n\n\nGLI/GLU\nGlicemia\n30 - 500\nmg/dL\n\n\nHGL\nHemoglobina Glicada\n3 - 20\n%\n\n\n\n\n\n3.4.3 CTEs Envolvidas\n\n3.4.3.1 exames_historico\nFonte: saude_historico_clinico.exame (UNNEST do array exames)\nObjetivo: Extrair exames da base histórica consolidada.\nCampos capturados: - paciente_cpf - cod_exame: Código do exame (CRE, COL, etc.) - unidade - resultado_num: Resultado convertido para FLOAT64 - data_exame: Data parseada do formato %d/%m/%Y %H:%M:%S\nFiltros aplicados: - Resultado não nulo - Código do exame na lista definida - CPF não nulo - Resultado &gt; 0 e &lt; 10000 (sanidade)\n\n\n3.4.3.2 exames_cientifica\nFonte: brutos_cientificalab.solicitacoes + brutos_cientificalab.exames + brutos_cientificalab.resultados\nObjetivo: Extrair exames do laboratório Científica (rede municipal).\nEstrutura de JOINs:\nsolicitacoes (paciente_cpf) \n    → exames (cod_apoio, data_assinatura) \n    → resultados (resultado)\nMesmos filtros de validação da CTE anterior.\n\n\n3.4.3.3 todos_exames\nObjetivo: UNION ALL das fontes de exames.\n\n\n3.4.3.4 exames_filtrados\nObjetivo: Aplica filtros de faixa válida específicos por tipo de exame.\nRegras de filtragem:\n(cod_exame = 'COL' AND resultado_num BETWEEN 50 AND 600)\nOR (cod_exame = 'HDL' AND resultado_num BETWEEN 10 AND 150)\nOR (cod_exame = 'LDL' AND resultado_num BETWEEN 20 AND 400)\nOR (cod_exame = 'TRI' AND resultado_num BETWEEN 20 AND 1000)\nOR (cod_exame = 'GLI' AND resultado_num BETWEEN 30 AND 500)\nOR (cod_exame = 'GLU' AND resultado_num BETWEEN 30 AND 500)\nOR (cod_exame = 'HGL' AND resultado_num BETWEEN 3 AND 20 AND unidade = '%')\nOR (cod_exame = 'CRE' AND resultado_num BETWEEN 0.2 AND 15 AND unidade = 'mg/dL')\n\n\n3.4.3.5 exames_mais_recentes\nObjetivo: Mantém apenas o exame mais recente de cada tipo por CPF.\nRegra: ROW_NUMBER() OVER (PARTITION BY paciente_cpf, cod_exame ORDER BY data_exame DESC) = 1\n\n\n3.4.3.6 exames_pivot\nObjetivo: Transpõe os exames de linhas para colunas, criando uma estrutura de 1 linha por paciente.\nCampos produzidos: | Campo | Descrição | |——-|———–| | cpf | CPF do paciente | | creatinina | Último valor de creatinina | | colesterol_total | Último valor de colesterol total | | hdl | Último valor de HDL | | ldl | Último valor de LDL | | triglicerides | Último valor de triglicerídeos | | glicemia | Último valor de glicemia (GLI ou GLU, com COALESCE) | | hba1c | Último valor de HbA1c | | data_creatinina | Data do exame de creatinina | | data_colesterol | Data do exame de colesterol | | data_hdl | Data do exame de HDL | | data_ldl | Data do exame de LDL | | data_glicemia | Data do exame de glicemia | | data_hba1c | Data do exame de HbA1c | | dias_desde_ultimo_exame | Dias desde o exame mais recente (entre CRE, COL, HDL, LDL) | | dias_desde_ultima_glicemia | Dias desde última glicemia |\n\n\n\n3.4.4 Uso no Dashboard\n\nCálculo de eGFR (requer creatinina)\nEstratificação de risco cardiovascular (requer perfil lipídico)\nClassificação de dislipidemia (ATP III)\nControle glicêmico em diabéticos\nIdentificação de lacunas de exames laboratoriais",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-3-dados-demográficos-e-de-cadastro",
    "href": "docu_enxuto.html#seção-3-dados-demográficos-e-de-cadastro",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.5 Seção 3: Dados Demográficos e de Cadastro",
    "text": "3.5 Seção 3: Dados Demográficos e de Cadastro\n\n3.5.1 Objetivo Clínico\nEstabelecer a base de pacientes com seus dados demográficos e vínculo com a ESF (Equipe de Saúde da Família).\n\n\n3.5.2 CTE: dados_paciente\nFonte: saude_historico_clinico.paciente + saude_dados_mestres.estabelecimento\nCampos produzidos:\n\n3.5.2.1 Dados Pessoais\n\n\n\nCampo\nTipo\nDescrição\n\n\n\n\ncpf\nSTRING\nCPF do paciente\n\n\nnome\nSTRING\nNome completo\n\n\ngenero\nSTRING\n“masculino” ou “feminino”\n\n\ndata_nascimento\nDATE\nData de nascimento\n\n\nidade\nINT64\nIdade calculada em anos\n\n\nraca\nSTRING\nRaça/cor autodeclarada\n\n\n\n\n\n3.5.2.2 Dados de Cadastro na ESF\n\n\n\nCampo\nTipo\nDescrição\n\n\n\n\nid_ine_cadastro\nSTRING\nINE da equipe de cadastro\n\n\nnome_esf_cadastro\nSTRING\nNome da ESF (sem numeração romana)\n\n\nid_cnes_cadastro\nSTRING\nCNES da unidade de cadastro\n\n\nnome_clinica_cadastro\nSTRING\nNome da unidade (corrigido)\n\n\nnome_medico_esf_cadastro\nSTRING\nMédico da equipe\n\n\nnome_enfermeiro_esf_cadastro\nSTRING\nEnfermeiro da equipe\n\n\narea_programatica_cadastro\nSTRING\nAP do estabelecimento\n\n\n\nTransformações aplicadas:\n\nRemoção de numeração romana do nome da ESF:\n\nREGEXP_REPLACE(\n    p.equipe_saude_familia[SAFE_OFFSET(0)].nome,\n    r'\\s+(I|II|III|IV|V|VI|VII|VIII|IX|X|XI|XII|XIII|XIV|XV|XVI|XVII|XVIII|XIX|XX)\\s*$', \n    ''\n)\n\nCorreção de nome de unidade específica:\n\nREPLACE(\n    p.equipe_saude_familia[SAFE_OFFSET(0)].clinica_familia.nome,\n    'Policlinica Newton Bethlem', \n    'CMS Newton Bethlem'\n)\nFiltros de exclusão: - CPF nulo - Óbito registrado (obito_indicador = TRUE ou obito_data IS NOT NULL) - ESB (Equipe de Saúde Bucal): NOT REGEXP_CONTAINS(UPPER(...), r'ESB') - INE nulo\nNota importante: O array equipe_saude_familia é acessado com SAFE_OFFSET(0) porque contém apenas um elemento por paciente (descoberta durante desenvolvimento).\n\n\n\n3.5.3 Uso no Dashboard\n\nFiltros hierárquicos (AP → Unidade → ESF)\nIdentificação de profissionais responsáveis\nCálculos que dependem de idade e gênero (eGFR, Framingham)\nEstratificação populacional",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-4-medidas-antropométricas",
    "href": "docu_enxuto.html#seção-4-medidas-antropométricas",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.6 Seção 4: Medidas Antropométricas",
    "text": "3.6 Seção 4: Medidas Antropométricas\n\n3.6.1 Objetivo Clínico\nObter as medidas mais recentes de peso, altura e IMC para cálculo de obesidade e avaliação nutricional.\n\n\n3.6.2 CTE: ultimas_medidas_antropometricas\nFontes: 1. sub_pav_us.indicadores_vitacare_fix - Dados corrigidos do Vitacare 2. saude_historico_clinico.episodio_assistencial - Episódios assistenciais\nCampos produzidos: | Campo | Tipo | Descrição | |——-|——|———–| | cpf | STRING | CPF do paciente | | peso | FLOAT64 | Peso em kg | | altura | FLOAT64 | Altura em metros | | IMC | FLOAT64 | Índice de Massa Corporal calculado | | obesidade_por_IMC | BOOL | TRUE se IMC ≥ 30 | | data_peso | DATE | Data da medição do peso | | data_altura | DATE | Data da medição da altura | | fonte | STRING | “vitacare” ou “episodio_assistencial” |\nLógica de consolidação: 1. UNION ALL das duas fontes 2. Deduplicação mantendo o registro mais recente: ORDER BY COALESCE(data_peso, data_altura) DESC 3. Uma única linha por CPF (rn_final = 1)\nCálculo do IMC:\nROUND(peso / POWER(altura, 2), 1)\nCritério de obesidade:\nIMC &gt;= 30\n\n\n3.6.3 Uso no Dashboard\n\nClassificação nutricional\nIdentificação de obesidade (morbidade)\nLacuna de IMC não calculável (falta peso ou altura)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-5-morbidades-por-cid",
    "href": "docu_enxuto.html#seção-5-morbidades-por-cid",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.7 Seção 5: Morbidades por CID",
    "text": "3.7 Seção 5: Morbidades por CID\n\n3.7.1 Objetivo Clínico\nIdentificar 56 condições clínicas através de códigos CID registrados nos episódios assistenciais. Para cada condição, captura-se a primeira data de diagnóstico.\n\n\n3.7.2 CTEs Envolvidas\n\n3.7.2.1 morbidades_base\nFonte: saude_historico_clinico.episodio_assistencial (UNNEST de condicoes)\nObjetivo: Extrair todos os pares CPF + CID + Data de entrada.\nCampos: - cpf: CPF limpo (11 dígitos) - entrada_data: Data do registro - cid: Código CID\n\n\n3.7.2.2 morbidades_por_cid\nObjetivo: Agrupa por CPF e identifica a primeira data (MIN) de cada condição.\nDeduplicação: QUALIFY ROW_NUMBER() OVER (PARTITION BY cpf ORDER BY cpf) = 1\n\n\n\n3.7.3 Catálogo de Morbidades\n\n3.7.3.1 Seção 1: Morbidades Principais\n\n\n\n\n\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\nHAS\nHipertensão Arterial\n^(I1[0-6]\\|O1[01])\n\n\nDM\nDiabetes Mellitus\n^(E1[0-4]\\|O24\\|H360\\|H280\\|G632\\|G590\\|G990\\|N083\\|M142)\n\n\n\nNota: HAS e DM são posteriormente expandidos com critérios de medidas e medicamentos.\n\n\n3.7.3.2 Seção 2: Cardiovasculares\n\n\n\n\n\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\nCI\nCardiopatia Isquêmica\n^(I2[0-5]\\|Z95[15])\n\n\nICC\nInsuficiência Cardíaca\n^(I110\\|I13[02]\\|I42[0-9]\\|I43\\|I50\\|I517\\|P290)\n\n\nstroke\nAVC/Stroke\n^(I6\\|G4[56]\\|H340)\n\n\narritmia\nArritmias (incl. FA)\n^(I44[1-3]\\|I45[69]\\|I4[7-9]\\|R00[018]\\|T821\\|Z45[05]\\|Z950)\n\n\nvalvular\nDoença Valvar\n^(A520\\|I0[5-9]\\|I34\\|I3[5-9]\\|Q23[0-3]\\|Z95[2-4])\n\n\ncirc_pulm\nCirculação Pulmonar\n^(I2[6-8])\n\n\nvascular_periferica\nDoença Vascular Periférica\n^(I7[01]\\|I73[189]\\|I77[12]\\|I79[02]\\|K55[189]\\|Z95[89])\n\n\n\n\n\n3.7.3.3 Seção 3: Neurológicas\n\n\n\n\n\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\nepilepsy\nEpilepsia\n^(G4[01])\n\n\nparkinsonism\nParkinsonismo\n^(G2[0-2])\n\n\nmultiple_sclerosis\nEsclerose Múltipla\n^G35\n\n\nneuro\nOutras Neurológicas\n^(G1[0-3]\\|G25[45]\\|G31[012]\\|G3[2367]\\|G93[14]\\|R470\\|R56)\n\n\ndementia\nDemência\n^(F0[0-35]\\|G30)\n\n\nplegia\nPlegia/Paralisia\n^(G041\\|G114\\|G80[12]\\|G8[1-3])\n\n\n\n\n\n3.7.3.4 Seção 4: Psiquiátricas\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\npsicoses\nPsicoses e Transtorno Bipolar\n^(F2[0-9]\\|F31)\n\n\ndepre_ansiedade\nDepressão e Ansiedade\n^(F3[2-49]\\|F4[01])\n\n\n\nNota: depre_ansiedade não entra no cálculo de multimorbidade (decisão clínica).\n\n\n3.7.3.5 Seção 5: Pulmonares\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\nCOPD\nDPOC\n^(I27[89]\\|J4[0-4]\\|J47\\|J6[0-7]\\|J684\\|J70[13])\n\n\nasthma\nAsma\n^(J4[56])\n\n\n\n\n\n3.7.3.6 Seção 6: Neoplasias\n\n\n\n\n\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\nneoplasia_mama\nNeoplasia de Mama\n^C50\n\n\nneoplasia_colo_uterino\nNeoplasia de Colo Uterino\n^C53\n\n\nneoplasia_feminina_estrita\nOutras Neoplasias Femininas\n^(C5[1-28])\n\n\nneoplasia_masculina_estrita\nNeoplasias Masculinas\n^(C6[0-3])\n\n\nleukemia\nLeucemia\n^(C9[1-5])\n\n\nlymphoma\nLinfoma\n^(C8[1-6]\\|C96)\n\n\nmetastasis\nMetástase\n^(C7[7-9]\\|C80)\n\n\nneoplasia_ambos_os_sexos\nOutras Neoplasias\n^(C[0-4][0-9]\\|C[567][0-9]) excluindo as específicas\n\n\n\n\n\n3.7.3.7 Seção 7: Renais e Metabólicas\n\n\n\n\n\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\nIRC_por_CID\nDRC por CID\n^(I120\\|I131\\|N03[2-7]\\|N05[2-7]\\|N1[89]\\|N250\\|Z49[0-2]\\|Z940\\|Z992)\n\n\ndislipidemia_por_CID\nDislipidemia por CID\n^E78\n\n\nobesidade\nObesidade\n^E66\n\n\ntireoide\nDoenças da Tireoide\n^(E0[0-3]\\|E05\\|E06\\|E890)\n\n\n\n\n\n3.7.3.8 Seção 8: Hematológicas\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\ncoagulo\nDistúrbios de Coagulação\n^(D6[5-9])\n\n\nanemias\nAnemias\n^(D5[0-3])\n\n\n\nNota: anemias não entra no cálculo de multimorbidade.\n\n\n3.7.3.9 Seção 9: Reumatológicas\n\n\n\n\n\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\nreumato\nDoenças Reumatológicas\n^(L93\\|L94[013]\\|M0[5-68]\\|M12[03]\\|M3[0-5]\\|M4[5-6])\n\n\n\n\n\n3.7.3.10 Seção 10: Uso de Substâncias\n\n\n\n\n\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\nalcool\nTranstornos por Álcool\n^(F10\\|E52\\|G621\\|I426\\|K292\\|K70\\|T51\\|Z502\\|Z714\\|Z721)\n\n\ndrogas\nTranstornos por Drogas\n^(F1[1-9]\\|Z715\\|Z722)\n\n\ntabaco\nTabagismo\n^(F17\\|Z716)\n\n\n\nNota: tabaco não entra no cálculo de multimorbidade, mas é usado no Framingham.\n\n\n3.7.3.11 Seção 11: Gastrointestinais\n\n\n\n\n\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\npeptic\nDoença Péptica\n^(K2[5-8])\n\n\nliver\nDoença Hepática\n^(B18\\|I8[56]\\|I982\\|K70\\|K71[1357]\\|K72[19]\\|K7[3-6]\\|Z944)\n\n\ndiverticular_disease\nDoença Diverticular\n^K57\n\n\nibd\nDoença Inflamatória Intestinal\n^(K5[01])\n\n\n\nNota: peptic não entra no cálculo de multimorbidade.\n\n\n3.7.3.12 Seção 12: Infecciosas\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\nSIDA\nHIV/AIDS por CID\n^(B2[0-4]\\|Z21\\|R75\\|O987\\|P352)\n\n\n\n\n\n3.7.3.13 Seção 13: Outras\n\n\n\n\n\n\n\n\nCampo\nCondição\nPadrão REGEX\n\n\n\n\ndesnutricao\nDesnutrição\n^(E4[0-36])\n\n\nretardo_mental\nDeficiência Intelectual\n^(F7[0-9])\n\n\nolhos\nDoenças Oculares\n^(H18\\|H201\\|H2[56]\\|H33\\|H360\\|H4[026]\\|H46\\|H540)\n\n\nouvidos\nDoenças Auditivas\n^(H9[01])\n\n\nma_formacoes\nMalformações Congênitas\n^(Q0[0-7]\\|Q3[5-7]\\|Q6[0-2]\\|Q8[01]\\|Q9[0-9])\n\n\npele\nDoenças de Pele\n^(L1[0-49]\\|L20\\|L4[013]\\|L80\\|L89\\|L90\\|L990\\|Q85[01])\n\n\npainful_condition\nCondições Dolorosas Crônicas\n^(R52[12]\\|M79[27]\\|G89[034])\n\n\nprostate_disorder\nDoenças da Próstata\n^(N4[0-2])\n\n\n\n\n\n\n3.7.4 Uso no Dashboard\n\nIdentificação de condições crônicas\nCálculo de multimorbidade\nEstratificação por condição específica\nÍndice de Charlson",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-5b-critérios-expandidos-de-has",
    "href": "docu_enxuto.html#seção-5b-critérios-expandidos-de-has",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.8 Seção 5B: Critérios Expandidos de HAS",
    "text": "3.8 Seção 5B: Critérios Expandidos de HAS\n\n3.8.1 Objetivo Clínico\nExpandir o diagnóstico de HAS além do CID, incluindo: 1. Medidas de PA críticas (≥180/110) 2. Medidas de PA alteradas repetidas (≥140/90 em 2 ou mais ocasiões) 3. Uso de medicamentos anti-hipertensivos\n\n\n3.8.2 CTEs Envolvidas\n\n3.8.2.1 todas_medidas_pa\nFonte: episodio_assistencial + PA_A1C_glic_cpf_fix (correções)\nObjetivo: Consolidar todas as medidas de PA com valores corrigidos.\nCampos: - cpf - pressao_sistolica: PAS corrigida - pressao_diastolica: PAD corrigida - data_medicao\n\n\n3.8.2.2 criterios_has_medidas\nObjetivo: Identificar critérios de HAS baseados em medidas.\nCampos produzidos: | Campo | Descrição | Critério | |——-|———–|———-| | has_por_medida_critica | Data da primeira medida crítica | PAS ≥ 180 OU PAD ≥ 110 | | n_medidas_alteradas | Contagem de medidas alteradas | PAS 140-179 OU PAD 90-109 | | has_por_medidas_repetidas | Data da 2ª medida alterada | Se n_medidas_alteradas ≥ 2 |\nLógica para 2ª medida:\nARRAY_AGG(... ORDER BY data_medicao)[SAFE_OFFSET(1)]\n\n\n3.8.2.3 criterios_has_medicamentos\nFonte: episodio_assistencial (UNNEST de prescricoes)\nObjetivo: Identificar uso de anti-hipertensivos.\nPadrão REGEX de anti-hipertensivos:\nREGEXP_CONTAINS(UPPER(presc.nome), r'(HIDROCLOROTIAZIDA|CLORTALIDONA|INDAPAMIDA|\nCAPTOPRIL|ENALAPRIL|LISINOPRIL|RAMIPRIL|PERINDOPRIL|BENAZEPRIL|\nLOSARTANA|VALSARTANA|CANDESARTANA|IRBESARTANA|OLMESARTANA|TELMISARTANA|\nANLODIPINO|NIFEDIPINO|FELODIPINO|VERAPAMIL|DILTIAZEM|\nATENOLOL|PROPRANOLOL|METOPROLOL|CARVEDILOL|BISOPROLOL|\nMETILDOPA|CLONIDINA|HIDRALAZINA|ALISQUIRENO)')\nCampo produzido: - has_por_medicamento: Data da primeira prescrição de anti-hipertensivo\n\n\n\n3.8.3 Uso no Dashboard\n\nDiagnóstico ampliado de HAS\nIdentificação de HAS sem CID registrado\nPriorização de pacientes para codificação",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-5c-critérios-expandidos-de-dm",
    "href": "docu_enxuto.html#seção-5c-critérios-expandidos-de-dm",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.9 Seção 5C: Critérios Expandidos de DM",
    "text": "3.9 Seção 5C: Critérios Expandidos de DM\n\n3.9.1 Objetivo Clínico\nExpandir o diagnóstico de DM além do CID, incluindo: 1. Exames laboratoriais (glicemia ≥126 ou HbA1c ≥6.5) 2. Progressão de pré-diabetes 3. Uso de hipoglicemiantes\n\n\n3.9.2 CTEs Envolvidas\n\n3.9.2.1 todas_medidas_glicemia\nFonte: episodio_assistencial + PA_A1C_glic_cpf_fix (correções)\nCampos: - cpf - glicemia: Valor corrigido - hba1c: Valor corrigido - data_coleta - id_hci\n\n\n3.9.2.2 criterios_dm_medidas\nCampos produzidos: | Campo | Descrição | Critério | |——-|———–|———-| | dm_por_exames | Data do primeiro exame diagnóstico | Glicemia ≥ 126 OU HbA1c ≥ 6.5 | | n_medidas_pre_dm | Contagem de medidas pré-DM | Glicemia 100-125 OU HbA1c 5.7-6.4 | | dm_por_progressao_pre_dm | Data da 2ª medida de pré-DM | Se n ≥ 2, confirma DM | | pre_dm_por_exames | Data da primeira medida pré-DM | Para pacientes sem DM confirmado |\n\n\n3.9.2.3 criterios_dm_medicamentos\nPadrão REGEX de hipoglicemiantes FORTES (confirmam DM):\nREGEXP_CONTAINS(UPPER(presc.nome), r'(GLICLAZIDA|GLIBENCLAMIDA|GLIMEPIRID|GLIPIZIDA|\nREPAGLINIDA|NATEGLINIDA|PIOGLITAZONA|ROSIGLITAZONA|\nSITAGLIPTINA|VILDAGLIPTINA|SAXAGLIPTINA|LINAGLIPTINA|\nEXENATIDA|DULAGLUTIDA|LIXISENATIDA|TIRZEPATIDA|\nINSULINA|NPH|LISPRO|ASPARTE|GLULISINA|GLARGINA|DETEMIR|DEGLUDECA)')\nCampos produzidos: - dm_por_medicamento_forte: Data da primeira prescrição de hipoglicemiante forte - tem_apenas_metformina: Flag booleano (metformina isolada NÃO confirma DM)\nRegra importante: Metformina isolada não confirma DM porque é usada para síndrome metabólica e SOP.\n\n\n\n3.9.3 Uso no Dashboard\n\nDiagnóstico ampliado de DM\nIdentificação de pré-diabéticos\nIdentificação de DM sem CID registrado",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-5d-consolidação-has-dm",
    "href": "docu_enxuto.html#seção-5d-consolidação-has-dm",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.10 Seção 5D: Consolidação HAS + DM",
    "text": "3.10 Seção 5D: Consolidação HAS + DM\n\n3.10.1 CTE: has_dm_consolidado\nObjetivo: Unificar todos os critérios de HAS e DM em uma única CTE, determinando a primeira data de diagnóstico por qualquer critério.\nLógica de consolidação HAS:\nHAS = MIN(has_por_cid, has_por_medida_critica, has_por_medidas_repetidas, has_por_medicamento)\nOnde MIN ignora valores NULL.\nLógica de consolidação DM:\nDM = MIN(dm_por_cid, dm_por_exames, dm_por_progressao_pre_dm, dm_por_medicamento_forte)\nExceção: Se tem_apenas_metformina = TRUE e nenhum outro critério, DM = NULL.\nCampos produzidos para HAS: | Campo | Descrição | |——-|———–| | HAS | Data do diagnóstico consolidado | | has_por_cid | Data do CID | | has_por_medida_critica | Data da PA crítica | | has_por_medidas_repetidas | Data da 2ª PA alterada | | has_por_medicamento | Data da prescrição | | HAS_sem_CID | TRUE se diagnosticado sem CID |\nCampos produzidos para DM: | Campo | Descrição | |——-|———–| | DM | Data do diagnóstico consolidado | | dm_por_cid | Data do CID | | dm_por_exames | Data do exame diagnóstico | | dm_por_progressao_pre_dm | Data da progressão | | dm_por_medicamento_forte | Data da prescrição | | DM_sem_CID | TRUE se diagnosticado sem CID | | pre_DM | Data do pré-DM (se DM = NULL) |\n\n\n3.10.2 Uso no Dashboard\n\nDetalhamento da origem do diagnóstico\nIdentificação de subnotificação de CID\nData exata para cálculo de tempo de doença",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-5e-progressão-glicêmica",
    "href": "docu_enxuto.html#seção-5e-progressão-glicêmica",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.11 Seção 5E: Progressão Glicêmica",
    "text": "3.11 Seção 5E: Progressão Glicêmica\n\n3.11.1 Objetivo Clínico\nAvaliar a tendência temporal do controle glicêmico em diabéticos, comparando HbA1c atual com anterior.\n\n\n3.11.2 CTEs Envolvidas\n\n3.11.2.1 hba1c_progressao\nObjetivo: Para cada paciente, obter a HbA1c mais recente e a anterior.\nUsa: LAG() para capturar valor anterior.\nCampos: - hba1c_atual, data_hba1c_atual - hba1c_anterior, data_hba1c_anterior\n\n\n3.11.2.2 progressao_glicemica\nObjetivo: Classificar status e tendência do controle glicêmico.\nMeta de HbA1c por idade: | Idade | Meta | |——-|——| | &lt; 60 anos | 7.0% | | ≥ 60 anos | 7.5% |\nStatus de controle (status_controle_glicemico):\nPara pacientes SEM DM: - rastreio - normal: HbA1c &lt; 5.7 - rastreio - pre_diabetes: HbA1c 5.7-6.4 - rastreio - provável_diabetes: HbA1c ≥ 6.5\nPara pacientes COM DM: - sem_dados: Sem HbA1c - abaixo_da_meta: Idade ≥ 70 e HbA1c &lt; 6.0 (risco de hipoglicemia) - dentro_da_meta: HbA1c ≤ meta - fora_da_meta: HbA1c &gt; meta\nTendência (tendencia_hba1c):\nPara pacientes SEM DM: Apenas classificação de rastreio.\nPara pacientes COM DM: - Se dentro/abaixo da meta: estavel - Se fora da meta: - melhorando: Queda &gt; 0.4% - piorando: Aumento &gt; 0.4% - estavel: Variação ≤ 0.4% - sem_referencia_previa: Sem HbA1c anterior\n\n\n3.11.2.3 historico_controle_glicemia\nObjetivo: Calcular dias em cada status de controle, interpolando entre medições.\nLógica: Para cada medição de HbA1c, calcula os dias até a próxima medição (ou até hoje se for a última). Classifica esse período como “controlado” ou “descontrolado”.\n\n\n3.11.2.4 resumo_controle_glicemia\nCampos produzidos: | Campo | Descrição | |——-|———–| | dias_dm_controlado | Total de dias controlado desde diagnóstico | | dias_dm_descontrolado | Total de dias descontrolado | | dias_desde_ultima_hba1c | Dias desde última medição | | pct_dias_dm_controlado | Percentual de dias controlado | | dias_dm_controlado_365d | Dias controlado nos últimos 365 dias | | dias_dm_descontrolado_365d | Dias descontrolado nos últimos 365 dias | | pct_dias_dm_controlado_365d | Percentual nos últimos 365 dias |\n\n\n3.11.2.5 ultimas_medidas_glicemia\nObjetivo: Gerar strings formatadas das últimas 3 medidas.\nCampos: - ultimas_tres_glicemias: Ex: “156 mg/dL; 142 mg/dL; 138 mg/dL” - ultimas_tres_A1C: Ex: “7.2%; 7.8%; 8.1%”\n\n\n\n3.11.3 Uso no Dashboard\n\nCartão do paciente com histórico glicêmico\nIdentificação de pacientes piorando\nMétricas de qualidade de controle",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-5f-progressão-pressórica",
    "href": "docu_enxuto.html#seção-5f-progressão-pressórica",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.12 Seção 5F: Progressão Pressórica",
    "text": "3.12 Seção 5F: Progressão Pressórica\n\n3.12.1 Objetivo Clínico\nAvaliar a tendência temporal do controle pressórico em hipertensos, análogo à progressão glicêmica.\n\n\n3.12.2 CTEs Envolvidas\n\n3.12.2.1 todas_medidas_pa_completas\nObjetivo: Consolidar todas as medidas de PA com correções.\n\n\n3.12.2.2 pa_progressao\nObjetivo: Obter PA mais recente e anterior por paciente.\n\n\n3.12.2.3 progressao_pressao\nMeta de PA por idade: | Idade | Meta PAS | Meta PAD | |——-|———-|———-| | &lt; 80 anos | 140 | 90 | | ≥ 80 anos | 150 | 90 |\nStatus de controle (status_controle_pressorio):\nPara pacientes SEM HAS: - rastreio - normal: PAS &lt; 120 e PAD &lt; 80 - rastreio - pre_hipertensao: PAS &lt; 130 e PAD &lt; 85 - rastreio - limítrofe: PAS &lt; 140 ou PAD &lt; 90 - rastreio - provável_HAS: PAS ≥ 140 ou PAD ≥ 90\nPara pacientes COM HAS: - controlado: Dentro da meta - descontrolado: Fora da meta\nTendência (tendencia_pa): - Se controlado: estavel - Se descontrolado: - melhorando: Queda de PAS &gt; 5 mmHg - piorando: Aumento de PAS &gt; 5 mmHg - estavel: Variação ≤ 5 mmHg\n\n\n3.12.2.4 historico_controle_pa e resumo_controle_pa\nAnálogos aos de glicemia, calculando dias controlado/descontrolado.\n\n\n3.12.2.5 ultimas_medidas_pa\nCampo: - ultimas_tres_PA: Ex: “138/88 mmHg; 142/92 mmHg; 156/98 mmHg”",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-6-consultas-e-longitudinalidade",
    "href": "docu_enxuto.html#seção-6-consultas-e-longitudinalidade",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.13 Seção 6: Consultas e Longitudinalidade",
    "text": "3.13 Seção 6: Consultas e Longitudinalidade\n\n3.13.1 Objetivo Clínico\nAvaliar o padrão de utilização dos serviços de saúde, identificando: - Volume de consultas - Regularidade de acompanhamento - Perfil de cuidado (médico vs enfermagem) - Longitudinalidade (consultas na unidade de cadastro vs fora)\n\n\n3.13.2 CTEs Envolvidas\n\n3.13.2.1 contagem_consultas_detalhada\nFonte: episodio_assistencial\nCampos produzidos - Totais históricos: | Campo | Descrição | |——-|———–| | consultas_total_historico | Total de consultas (todo período) | | consultas_medicas_historico | Com médico | | consultas_enfermagem_historico | Com enfermeiro |\nCampos produzidos - Últimos 365 dias: | Campo | Descrição | |——-|———–| | consultas_365d | Total nos últimos 365 dias | | consultas_medicas_365d | Com médico | | consultas_enfermagem_365d | Com enfermeiro | | consultas_medicas_na_unidade_365d | Médicas na unidade de cadastro | | consultas_medicas_fora_365d | Médicas fora da unidade | | consultas_enfermagem_na_unidade_365d | Enfermagem na unidade | | consultas_enfermagem_fora_365d | Enfermagem fora |\nCampos de datas: - data_primeira_consulta - data_ultima_consulta - data_ultima_medica - data_ultima_enfermagem\nRegularidade: - meses_com_consulta_12m: Contagem de meses distintos com consulta\nCritério de especialidade:\nprofissional_saude_responsavel.especialidade LIKE '%Médico%'\nprofissional_saude_responsavel.especialidade LIKE '%Enfermeiro%'\n\n\n3.13.2.2 intervalos_consultas\nObjetivo: Calcular intervalos entre consultas consecutivas.\nCampos: | Campo | Descrição | |——-|———–| | intervalo_mediano_dias | Mediana dos intervalos | | intervalo_medio_dias | Média dos intervalos | | ultimo_intervalo_dias | Intervalo entre as 2 últimas | | n_intervalos | Número de intervalos calculados |\n\n\n3.13.2.3 contagem_consultas\nObjetivo: Consolidar e calcular indicadores derivados.\nIndicadores temporais: - dias_desde_ultima_medica - dias_desde_ultima_enfermagem - dias_desde_ultima_consulta - dias_em_acompanhamento\nPercentuais: - pct_consultas_medico_365d - pct_consultas_enfermeiro_365d - pct_consultas_medicas_fora_365d - pct_consultas_medicas_na_unidade_365d\nCategorias:\nperfil_cuidado_365d: - sem_consultas: Nenhuma consulta em 365d - medico_centrado: ≥75% consultas com médico - enfermagem_centrado: ≥75% consultas com enfermeiro - compartilhado: 25-75% com médico - indefinido: Outros casos\nregularidade_acompanhamento: - sem_acompanhamento: 0 meses - esporadico: 1-2 meses - irregular: 3-5 meses - regular: ≥6 meses\nbaixa_longitudinalidade: - TRUE: &gt;50% das consultas médicas fora da unidade de cadastro\n\n\n\n3.13.3 Uso no Dashboard\n\nIdentificação de pacientes sem acompanhamento\nAvaliação de longitudinalidade\nComparação com benchmarks",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-7-consolidação-com-egfr",
    "href": "docu_enxuto.html#seção-7-consolidação-com-egfr",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.14 Seção 7: Consolidação com eGFR",
    "text": "3.14 Seção 7: Consolidação com eGFR\n\n3.14.1 CTE: dados_consolidados\nObjetivo: JOIN de todas as CTEs anteriores + cálculo de eGFR.\n\n\n3.14.2 Cálculo do eGFR (CKD-EPI 2021)\nFórmula:\n142 *\nPOWER(\n    LEAST(creatinina / CASE WHEN genero = 'feminino' THEN 0.7 ELSE 0.9 END, 1),\n    CASE WHEN genero = 'feminino' THEN -0.241 ELSE -0.302 END\n) *\nPOWER(\n    GREATEST(creatinina / CASE WHEN genero = 'feminino' THEN 0.7 ELSE 0.9 END, 1),\n    -1.200\n) *\nPOWER(0.9938, idade) *\nCASE WHEN genero = 'feminino' THEN 1.012 ELSE 1.0 END\nNota: Esta é a fórmula CKD-EPI 2021 sem ajuste racial (recomendação atual).\n\n\n3.14.3 Estadiamento CKD (ckd_stage)\n\n\n\neGFR (ml/min/1.73m²)\nEstágio\n\n\n\n\n≥ 90\nG1 - Normal ou alta\n\n\n60-89\nG2 - Levemente diminuída\n\n\n30-59\nG3 - Moderadamente diminuída\n\n\n15-29\nG4 - Severamente diminuída\n\n\n&lt; 15\nG5 - Falência renal\n\n\nNULL\nNão avaliado",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-7a-morbidades-consolidadas",
    "href": "docu_enxuto.html#seção-7a-morbidades-consolidadas",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.15 Seção 7A: Morbidades Consolidadas",
    "text": "3.15 Seção 7A: Morbidades Consolidadas\n\n3.15.1 Objetivo\nConsolidar morbidades que têm múltiplas fontes de diagnóstico.\n\n\n3.15.2 CTEs Envolvidas\n\n3.15.2.1 dados_com_irc\nObjetivo: Unificar IRC (CID ou eGFR).\nRegra:\nIRC = IRC_por_CID\n  OU (eGFR indica G3/G4/G5 E IRC_por_CID é NULL) → usar data_creatinina\n\n\n3.15.2.2 dados_com_hiv\nObjetivo: Unificar HIV (CID ou base externa).\nRegra:\nHIV = MENOR(SIDA, data_diagnostico_hiv)\n\n\n3.15.2.3 dados_com_dislipidemia\nObjetivo: Classificar perfil lipídico e unificar dislipidemia.\nClassificações ATP III:\n\n\n\nExame\nClassificação\nValor\n\n\n\n\nColesterol Total\nDesejável\n&lt; 200\n\n\n\nLimítrofe alto\n200-239\n\n\n\nAlto\n≥ 240\n\n\nLDL\nÓtimo\n&lt; 100\n\n\n\nAcima do ótimo\n100-129\n\n\n\nLimítrofe alto\n130-159\n\n\n\nAlto\n160-189\n\n\n\nMuito alto\n≥ 190\n\n\nHDL\nBaixo\n&lt; 40 (M) / &lt; 50 (F)\n\n\n\nNormal\n40-59 (M) / 50-59 (F)\n\n\n\nDesejável (protetor)\n≥ 60\n\n\nTriglicerídeos\nNormal\n&lt; 150\n\n\n\nLimítrofe alto\n150-199\n\n\n\nAlto\n200-499\n\n\n\nMuito alto\n≥ 500\n\n\n\nCritérios de dislipidemia laboratorial: - dislipidemia_por_CT: CT ≥ 200 - dislipidemia_por_LDL: LDL ≥ 130 - dislipidemia_por_HDL_baixo: HDL &lt; 40 (M) ou &lt; 50 (F) - dislipidemia_por_TG: TG ≥ 150\nDislipidemia unificada:\ndislipidemia = MENOR(dislipidemia_por_CID, data do primeiro exame alterado)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-7b-multimorbidade",
    "href": "docu_enxuto.html#seção-7b-multimorbidade",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.16 Seção 7B: Multimorbidade",
    "text": "3.16 Seção 7B: Multimorbidade\n\n3.16.1 CTE: morbidades_array\nObjetivo: Contar morbidades e identificar data da multimorbidade.\nMorbidades incluídas no cálculo (33 condições):\n\nHAS, DM\nCI, ICC, stroke, arritmia, valvular, circ_pulm, vascular_periferica\nepilepsy, parkinsonism, multiple_sclerosis, neuro, dementia, plegia\npsicoses (depre_ansiedade EXCLUÍDA)\nCOPD, asthma\nneoplasia_mama, neoplasia_colo_uterino, neoplasia_feminina_estrita, neoplasia_masculina_estrita, leukemia, lymphoma, metastasis, neoplasia_ambos_os_sexos\nIRC, dislipidemia, obesidade, tireoide\ncoagulo (anemias EXCLUÍDA)\nreumato\nalcool, drogas (tabaco EXCLUÍDO)\nliver, diverticular_disease, ibd (peptic EXCLUÍDA)\nHIV\n\nCampos produzidos: | Campo | Descrição | |——-|———–| | total_morbidades | Contagem de morbidades distintas | | multimorbidade | Data da 2ª morbidade (quando se torna multimórbido) | | eh_multimorbido | TRUE se total_morbidades ≥ 2 |\nDeduplicação: COUNT(DISTINCT data) e ARRAY_AGG(DISTINCT data) para evitar contagem dupla de morbidades diagnosticadas na mesma data.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-8-prescrições-de-medicamentos",
    "href": "docu_enxuto.html#seção-8-prescrições-de-medicamentos",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.17 Seção 8: Prescrições de Medicamentos",
    "text": "3.17 Seção 8: Prescrições de Medicamentos\n\n3.17.1 CTE: ultimas_prescricoes_medicamentos\nObjetivo: Identificar a data da última prescrição de cada classe terapêutica relevante.\n\n\n3.17.2 Classes Terapêuticas e Padrões REGEX\n\n\n\n\n\n\n\n\nCampo\nClasse\nPadrão REGEX\n\n\n\n\ndata_ultima_AAS\nAntiagregante\nASPIRINA\\|AAS\\|ACIDO ACETILSALICILICO\\|ÁCIDO ACETILSALICÍLICO\\|SOMALGIN\\|ASPIRINA PREVENT\\|ECASIL\n\n\ndata_ultima_anticoag\nAnticoagulantes\nVARFARINA\\|WARFARIN\\|MAREVAN\\|COUMADIN\\|RIVAROXABAN\\|XARELTO\\|APIXABAN\\|ELIQUIS\\|DABIGATRAN\\|PRADAXA\\|EDOXABAN\\|LIXIANA\n\n\ndata_ultima_estatina_alta\nEstatina alta intensidade\nATORVASTATINA.*[4-8]0\\|ROSUVASTATINA.*[2-4]0\n\n\ndata_ultima_estatina_qualquer\nQualquer estatina\nATORVASTATINA\\|ROSUVASTATINA\\|SINVASTATINA\\|PRAVASTATINA\\|LOVASTATINA\\|FLUVASTATINA\\|PITAVASTATINA\n\n\ndata_ultima_SGLT2\nInibidores SGLT-2\nDAPAGLIFLOZINA\\|FORXIGA\\|EMPAGLIFLOZINA\\|JARDIANCE\\|CANAGLIFLOZINA\\|INVOKANA\\|SOTAGLIFLOZINA\n\n\ndata_ultima_BB\nBetabloqueadores\nMETOPROLOL.*SUCCINATO\\|CARVEDILOL\\|BISOPROLOL\\|COREG\\|CONCOR\\|SELOZOK.*ZOK\n\n\ndata_ultima_IECA\nIECA\nCAPTOPRIL\\|ENALAPRIL\\|LISINOPRIL\\|RAMIPRIL\\|PERINDOPRIL\\|BENAZEPRIL\\|FOSINOPRIL\\|QUINAPRIL\\|TRANDOLAPRIL\n\n\ndata_ultima_BRA\nBRA\nLOSARTANA\\|VALSARTANA\\|CANDESARTANA\\|IRBESARTANA\\|OLMESARTANA\\|TELMISARTANA\\|AZILSARTANA\\|EPROSARTANA\n\n\ndata_ultima_INRA\nINRA (Sacubitril)\nSACUBITRIL\\|ENTRESTO\n\n\ndata_ultima_diuretico_alca\nDiurético de alça\nFUROSEMIDA\\|BUMETANIDA\\|TORASEMIDA\\|LASIX\n\n\ndata_ultima_ARM\nAntagonista Mineralocorticoide\nESPIRONOLACTONA\\|ALDACTONE\\|EPLERENONA\\|INSPRA\n\n\ndata_ultima_BCC_nao_DHP\nBCC não-dihidropiridínico\nVERAPAMIL\\|DILTIAZEM\\|CARDIZEM\n\n\ndata_ultima_AINE\nAnti-inflamatórios\nIBUPROFENO\\|DICLOFENACO\\|NAPROXENO\\|CETOPROFENO\\|PIROXICAM\\|MELOXICAM\\|NIMESULIDA\\|INDOMETACINA\\|ACECLOFENACO\n\n\ndata_ultima_hidralazina\nHidralazina\nHIDRALAZINA\n\n\ndata_ultima_nitrato\nNitratos\nISOSSORBIDA\\|MONONITRATO\\|DINITRATO\\|PROPATILNITRATO\n\n\ndata_ultima_digoxina\nDigoxina\nDIGOXINA\\|LANOXIN\n\n\n\n\n\n3.17.3 Uso no Dashboard\n\nIdentificação de lacunas de prescrição\nDetecção de combinações inadequadas\nAvaliação de adesão a guidelines",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-9-exames-solicitados",
    "href": "docu_enxuto.html#seção-9-exames-solicitados",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.18 Seção 9: Exames Solicitados",
    "text": "3.18 Seção 9: Exames Solicitados\n\n3.18.1 CTE: exames_solicitados_365d\nFonte: brutos_prontuario_vitacare.atendimento (campo exames_solicitados)\nObjetivo: Verificar se exames essenciais foram solicitados nos últimos 365 dias.\n\n\n3.18.2 Exames Monitorados\n\n\n\n\n\n\n\n\nCampo (tem_X_365d)\nCampo (data_solicitacao_X)\nPadrão REGEX\n\n\n\n\ntem_creatinina_365d\ndata_solicitacao_creatinina\nCREATININA\n\n\ntem_colesterol_365d\ndata_solicitacao_colesterol\nCOLESTEROL\\|HDL\\|LDL\\|TRIGLICERID\n\n\ntem_eas_365d\ndata_solicitacao_eas\nURINA\\|CARACTERES\\|SEDIMENTO\\|EAS\n\n\ntem_ecg_365d\ndata_solicitacao_ecg\nELETROCARDIOGRAMA\\|ECG\n\n\ntem_hba1c_solicitado_365d\ndata_solicitacao_hba1c\nHEMOGLOBINA.*GLICO\\|HEMOGLOBINA.*GLICADA\\|HBA1C\n\n\ntem_glicemia_365d\ndata_solicitacao_glicemia\nGLICOSE\\|GLICEMIA\n\n\ntem_microalbuminuria_365d\ndata_solicitacao_microalbuminuria\nMICROALBUMIN\n\n\ntem_hemograma_365d\ndata_solicitacao_hemograma\nHEMOGRAMA",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-10-exame-do-pé-diabético",
    "href": "docu_enxuto.html#seção-10-exame-do-pé-diabético",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.19 Seção 10: Exame do Pé Diabético",
    "text": "3.19 Seção 10: Exame do Pé Diabético\n\n3.19.1 CTE: exame_pe_diabetico\nFonte: brutos_prontuario_vitacare.atendimento (campo soap_plano_procedimentos_clinicos)\nPadrão REGEX:\nREGEXP_CONTAINS(UPPER(...), r'EXAME.*PÉ.*DIABÉTICO|PÉ.*DIABÉTICO')\nCampos produzidos: | Campo | Descrição | |——-|———–| | teve_exame_pe_365d | TRUE se teve nos últimos 365 dias | | teve_exame_pe_180d | TRUE se teve nos últimos 180 dias | | data_ultimo_exame_pe | Data do último exame | | dias_desde_ultimo_exame_pe | Dias desde o último |",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-11-escore-de-framingham",
    "href": "docu_enxuto.html#seção-11-escore-de-framingham",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.20 Seção 11: Escore de Framingham",
    "text": "3.20 Seção 11: Escore de Framingham\n\n3.20.1 Objetivo Clínico\nCalcular o risco cardiovascular em 10 anos usando o escore de Framingham tradicional.\n\n\n3.20.2 CTE: pontuacao_framingham\nComponentes pontuados:\n\n3.20.2.1 Pontos por Idade (Masculino)\n\n\n\nFaixa\nPontos\n\n\n\n\n30-34\n-1\n\n\n35-39\n0\n\n\n40-44\n1\n\n\n45-49\n2\n\n\n50-54\n3\n\n\n55-59\n4\n\n\n60-64\n5\n\n\n65-69\n6\n\n\n70-74\n7\n\n\n≥75\n8\n\n\n\n\n\n3.20.2.2 Pontos por Idade (Feminino)\n\n\n\nFaixa\nPontos\n\n\n\n\n30-34\n-9\n\n\n35-39\n-4\n\n\n40-44\n0\n\n\n45-49\n3\n\n\n50-54\n6\n\n\n55-59\n7\n\n\n60-64\n8\n\n\n≥65\n8\n\n\n\n\n\n3.20.2.3 Pontos por Colesterol Total\n\n\n\nCT (mg/dL)\nMasculino\nFeminino\n\n\n\n\n&lt; 160\n-3\n-2\n\n\n160-199\n0\n0\n\n\n200-239\n1\n1\n\n\n240-279\n2\n1\n\n\n≥ 280\n3\n3\n\n\n\n\n\n3.20.2.4 Pontos por HDL\n\n\n\nHDL (mg/dL)\nMasculino\nFeminino\n\n\n\n\n&lt; 35\n2\n5\n\n\n35-44\n1\n2\n\n\n45-49\n0\n1\n\n\n50-59\n0\n0\n\n\n≥ 60\n-1\n-2\n\n\n\n\n\n3.20.2.5 Pontos por PAS (sem tratamento)\n\n\n\nPAS (mmHg)\nMasculino\nFeminino\n\n\n\n\n&lt; 120\n0\n-3\n\n\n120-129\n0\n0\n\n\n130-139\n1\n1\n\n\n140-159\n2\n2\n\n\n≥ 160\n3\n4\n\n\n\n\n\n3.20.2.6 Pontos por PAS (com tratamento/HAS)\n\n\n\nPAS (mmHg)\nMasculino\nFeminino\n\n\n\n\n&lt; 120\n0\n-1\n\n\n120-129\n2\n2\n\n\n130-139\n3\n3\n\n\n140-159\n4\n5\n\n\n≥ 160\n5\n6\n\n\n\n\n\n3.20.2.7 Pontos por Diabetes\n\n\n\nGênero\nPontos\n\n\n\n\nMasculino\n2\n\n\nFeminino\n4\n\n\n\n\n\n3.20.2.8 Pontos por Tabagismo\n\n\n\n\nPontos\n\n\n\n\nAmbos\n2\n\n\n\n\n\n\n3.20.3 CTE: risco_calculado\nCampos produzidos: - pontos_totais: Soma de todos os componentes - percentual_risco_10_anos: Risco em % (tabela de conversão)\nTabela de conversão (Masculino): | Pontos | Risco % | |——–|———| | ≤ -3 | 1.0 | | -2 | 1.1 | | … | … | | 17 | 29.4 | | ≥ 18 | 30.0 |",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-12-risco-cardiovascular---estratificação-sbc",
    "href": "docu_enxuto.html#seção-12-risco-cardiovascular---estratificação-sbc",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.21 Seção 12: Risco Cardiovascular - Estratificação SBC",
    "text": "3.21 Seção 12: Risco Cardiovascular - Estratificação SBC\n\n3.21.1 CTE: risco_cardiovascular_estratificado\n\n\n3.21.2 Objetivo\nReclassificar o risco cardiovascular segundo diretrizes da Sociedade Brasileira de Cardiologia, que considera condições clínicas que elevam automaticamente o risco.\n\n\n3.21.3 Categorias de Risco\n\n\n\n\n\n\n\nCategoria\nCritérios\n\n\n\n\nMUITO ALTO\nCI, stroke ou vascular_periferica (aterosclerose significativa)\n\n\nALTO\nIRC, eGFR &lt; 60, ou LDL ≥ 190\n\n\nINTERMEDIÁRIO\nDM sem aterosclerose, ou Framingham 5-20% (M) / 5-10% (F)\n\n\nBAIXO\nFramingham &lt; 5%\n\n\n\n\n\n3.21.4 Campos Produzidos\n\n\n\n\n\n\n\nCampo\nDescrição\n\n\n\n\ntipo_estratificacao\n“reclassificado_muito_alto”, “reclassificado_alto”, “diabetes_avaliar_framingham”, “usar_framingham”\n\n\npercentual_risco_final\nRisco formatado (ex: “&gt;30%”, “12.5%”)\n\n\ncategoria_risco_final\n“MUITO ALTO”, “ALTO”, “INTERMEDIÁRIO”, “BAIXO”, “NÃO CLASSIFICADO”\n\n\nmotivo_reclassificacao\nTexto explicativo da reclassificação\n\n\nvariaveis_usadas_calculo\nLista de variáveis disponíveis\n\n\nvariaveis_ausentes_calculo\nLista de variáveis faltantes",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-13-índice-de-charlson",
    "href": "docu_enxuto.html#seção-13-índice-de-charlson",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.22 Seção 13: Índice de Charlson",
    "text": "3.22 Seção 13: Índice de Charlson\n\n3.22.1 Objetivo Clínico\nCalcular o Charlson Comorbidity Index modificado, incluindo pontuação por idade e polifarmácia.\n\n\n3.22.2 CTE: charlson_componentes\n\n\n3.22.3 Pesos por Morbidade\n\n\n\n\n\n\n\nPeso\nCondições\n\n\n\n\n1\nCI, ICC, vascular_periferica, dementia, COPD, peptic, DM sem IRC, alcool, arritmia, psicoses, HIV\n\n\n2\nDM com IRC, plegia, IRC sem DM, neoplasias sólidas, leukemia, lymphoma\n\n\n3\nliver (doença hepática)\n\n\n6\nmetastasis\n\n\n\n\n\n3.22.4 Pontos por Idade\n\n\n\nFaixa\nPontos\n\n\n\n\n&lt; 40\n0\n\n\n40-49\n1\n\n\n50-59\n2\n\n\n60-69\n3\n\n\n70-79\n4\n\n\n≥ 80\n5\n\n\n\n\n\n3.22.5 CTE: charlson_final\nJOIN com: MM_mantidos_alterados_ultimas (tabela de medicamentos crônicos)\n\n\n3.22.6 Pontos por Polifarmácia\n\n\n\nMedicamentos crônicos\nPontos\n\n\n\n\n0-4\n0\n\n\n5-9 (polifarmácia)\n1\n\n\n≥ 10 (hiperpolifarmácia)\n2\n\n\n\n\n\n3.22.7 Campos Produzidos\n\n\n\n\n\n\n\nCampo\nDescrição\n\n\n\n\ncharlson_pontos_morbidades\nPontos das comorbidades\n\n\ncharlson_pontos_idade\nPontos da idade\n\n\ncharlson_pontos_polifarmacia\nPontos da polifarmácia\n\n\ncharlson_score\nScore total\n\n\ncharlson_categoria\n“Baixo” (≤2), “Moderado” (3-6), “Alto” (7-9), “Muito Alto” (≥10)\n\n\ntotal_medicamentos_cronicos\nContagem de medicamentos\n\n\nnucleo_cronico_atual\nLista de medicamentos normalizados\n\n\npolifarmacia\nTRUE se 5-9 medicamentos\n\n\nhiperpolifarmacia\nTRUE se ≥10 medicamentos",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#seção-14-benchmark-de-consultas",
    "href": "docu_enxuto.html#seção-14-benchmark-de-consultas",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.23 Seção 14: Benchmark de Consultas",
    "text": "3.23 Seção 14: Benchmark de Consultas\n\n3.23.1 CTE: benchmark_consultas\n\n\n3.23.2 Objetivo\nCriar grupos de referência para comparação de padrões de consulta.\n\n\n3.23.3 Estratificação\n\n\n\nDimensão\nCategorias\n\n\n\n\nFaixa etária\n&lt;40, 40-59, 60-79, 80+\n\n\nGênero\nmasculino, feminino\n\n\nRisco Charlson\nbaixo (≤2), moderado (3-6), alto (≥7)\n\n\n\n\n\n3.23.4 Métricas Calculadas por Grupo\n\npercentis_consultas_365d: Array com P25, P50, P75, P100\npercentis_intervalo_mediano: Array com P25, P50, P75, P100\nmedia_consultas_365d: Média de consultas no grupo\nmedia_intervalo_mediano: Média do intervalo no grupo\nn_pacientes_grupo: Tamanho do grupo de referência\n\n\n\n3.23.5 Uso no SELECT Final\nComparação individual vs grupo: - percentil_intervalo_vs_grupo: “abaixo_p25”, “p25_p50”, “p50_p75”, “acima_p75” - percentil_consultas_vs_grupo: Idem\nFlags de inequidade: - alto_risco_baixo_acesso: Charlson ≥7 e consultas &lt; P25 do grupo - baixo_risco_alto_acesso: Charlson ≤2 e consultas &gt; P75 do grupo - alto_risco_intervalo_longo: Charlson ≥7 e intervalo &gt; P75 do grupo",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#glossário-de-lacunas-de-cuidado",
    "href": "docu_enxuto.html#glossário-de-lacunas-de-cuidado",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.24 Glossário de Lacunas de Cuidado",
    "text": "3.24 Glossário de Lacunas de Cuidado\n\n3.24.1 Definição\nLacunas de cuidado são indicadores booleanos que identificam situações onde o cuidado não está alinhado com guidelines ou boas práticas.\n\n\n3.24.2 Categoria 2: Cardiopatia Isquêmica\n\n\n\n\n\n\n\n\n\nLacuna\nDescrição\nCritério\nPrazo\n\n\n\n\nlacuna_CI_sem_AAS\nCI sem antiagregação\nCI presente E sem AAS há &gt;365d E sem anticoag há &gt;365d\n365 dias\n\n\nlacuna_CI_sem_estatina_alta\nCI sem estatina de alta intensidade\nCI presente E sem estatina alta há &gt;365d\n365 dias\n\n\nlacuna_CI_sem_estatina_qualquer\nCI sem nenhuma estatina\nCI presente E sem estatina há &gt;365d\n365 dias\n\n\nlacuna_CI_ICC_sem_BB\nCI+ICC sem betabloqueador\nCI E ICC E sem BB há &gt;365d\n365 dias\n\n\n\n\n\n3.24.3 Categoria 3: ICC e Uso Inadequado\n\n\n\n\n\n\n\n\n\nLacuna\nDescrição\nCritério\nPrazo\n\n\n\n\nlacuna_ICC_sem_SGLT2\nICC sem iSGLT2\nICC presente E sem SGLT2 há &gt;365d\n365 dias\n\n\nlacuna_ICC_sem_IECA_BRA\nICC sem bloqueio SRAA\nICC E sem IECA há &gt;365d E sem BRA há &gt;365d\n365 dias\n\n\nlacuna_ICC_sem_INRA\nICC sem sacubitril\nICC E sem INRA há &gt;365d\n365 dias\n\n\nlacuna_IECA_BRA_concomitante\nUso inadequado IECA+BRA\nIECA há ≤180d E BRA há ≤180d\n-\n\n\nlacuna_diur_alca_sem_ICC\nDiurético de alça sem ICC\nSem ICC E diurético alça há ≤180d\n-\n\n\nlacuna_ICC_sem_ARM\nICC sem espironolactona\nICC E sem ARM há &gt;365d\n365 dias\n\n\nlacuna_ICC_INRA_IECA_concomitante\nCombinação perigosa\nICC E INRA há ≤180d E IECA há ≤180d\n-\n\n\nlacuna_ICC_uso_BCC_nao_DHP\nBCC contraindicado em ICC\nICC E BCC não-DHP há ≤180d\n-\n\n\nlacuna_ICC_uso_AINE\nAINE inadequado em ICC\nICC E AINE há ≤180d\n-\n\n\nlacuna_IRC_sem_SGLT2\nIRC sem iSGLT2\nIRC E sem SGLT2 há &gt;365d\n365 dias\n\n\nlacuna_DM_complicado_sem_SGLT2\nDM complicado sem iSGLT2\nDM E (ICC ou IRC ou CI) E sem SGLT2 há &gt;365d\n365 dias\n\n\nlacuna_IRC_sem_iECA_ou_BRA\nIRC sem bloqueio SRAA\nIRC E sem IECA há &gt;365d E sem BRA há &gt;365d\n365 dias\n\n\nlacuna_ICC_sem_SRAA_e_sem_hidralazina_nitrato\nICC sem vasodilatador\nICC E sem IECA/BRA/INRA há &gt;365d E sem hidralazina/nitrato há &gt;365d\n365 dias\n\n\n\n\n\n3.24.4 Categoria 4: Fibrilação Atrial\n\n\n\n\n\n\n\n\n\nLacuna\nDescrição\nCritério\nPrazo\n\n\n\n\nlacuna_FA_sem_anticoagulacao\nFA sem anticoagulação\narritmia E sem anticoag há &gt;365d\n365 dias\n\n\nlacuna_FA_sem_controle_FC\nFA sem controle de frequência\narritmia E sem BB há &gt;365d E sem digoxina há &gt;365d\n365 dias\n\n\nlacuna_FA_ICC_sem_digoxina\nFA+ICC sem digoxina\narritmia E ICC E sem digoxina há &gt;365d\n365 dias\n\n\n\n\n\n3.24.5 Categoria 6: Diabetes\n\n\n\n\n\n\n\n\nLacuna\nDescrição\nCritério\n\n\n\n\nlacuna_DM_sem_HbA1c_recente\nDM sem monitoramento\nDM E (HbA1c NULL ou dias_desde &gt;180)\n\n\nlacuna_DM_descontrolado\nDM fora da meta\nDM E HbA1c &gt; meta (ajustada por idade) E HbA1c recente\n\n\nDM_controlado\nFlag positivo\nDM E HbA1c ≤ meta E HbA1c recente\n\n\nDM_piorando\nTendência negativa\nDM E aumento HbA1c &gt; 0.5% E intervalo ≥90d\n\n\nDM_melhorando\nTendência positiva\nDM E redução HbA1c &gt; 0.5% E intervalo ≥90d\n\n\n\n\n\n3.24.6 Lacunas de Exames Laboratoriais\n\n\n\n\n\n\n\n\nLacuna\nDescrição\nCritério\n\n\n\n\nlacuna_creatinina_HAS_DM\nSem creatinina\n(HAS ou DM) E sem creatinina solicitada 365d\n\n\nlacuna_colesterol_HAS_DM\nSem perfil lipídico\n(HAS ou DM) E sem colesterol solicitado 365d\n\n\nlacuna_eas_HAS_DM\nSem EAS\n(HAS ou DM) E sem EAS solicitado 365d\n\n\nlacuna_ecg_HAS_DM\nSem ECG\n(HAS ou DM) E sem ECG solicitado 365d\n\n\nlacuna_DM_hba1c_nao_solicitado\nDM sem HbA1c solicitada\nDM E sem HbA1c solicitada 365d\n\n\nlacuna_DM_microalbuminuria_nao_solicitado\nDM sem microalbuminúria\nDM E sem microalbuminúria solicitada 365d\n\n\n\n\n\n3.24.7 Lacunas de Medidas\n\n\n\n\n\n\n\n\nLacuna\nDescrição\nCritério\n\n\n\n\nlacuna_IMC_HAS_DM\nIMC não calculável\n(HAS ou DM) E (altura NULL ou peso NULL)\n\n\n\n\n\n3.24.8 Lacunas de Controle Pressórico\n\n\n\n\n\n\n\n\nLacuna\nDescrição\nCritério\n\n\n\n\nlacuna_rastreio_PA_adulto\nAdulto sem rastreio PA\nidade ≥18 E sem HAS E sem PA há &gt;365d\n\n\nlacuna_PA_hipertenso_180d\nHipertenso sem PA\nHAS E sem PA há &gt;180d\n\n\nlacuna_HAS_descontrolado_menor80\nHAS &lt;80a descontrolado\nHAS E idade &lt;80 E PA ≥140/90\n\n\nlacuna_HAS_descontrolado_80mais\nHAS ≥80a descontrolado\nHAS E idade ≥80 E PA ≥150/90\n\n\nlacuna_DM_HAS_PA_descontrolada\nDM+HAS PA &gt;135/80\nDM E HAS E PA &gt;135/80\n\n\n\n\n\n3.24.9 Lacunas de Rastreio DM\n\n\n\n\n\n\n\n\nLacuna\nDescrição\nCritério\n\n\n\n\nlacuna_rastreio_DM_hipertenso\nHipertenso sem rastreio DM\nHAS E sem DM E sem glicemia/HbA1c há &gt;365d\n\n\nlacuna_rastreio_DM_45mais\n≥45a sem rastreio DM\nidade ≥45 E sem DM E sem glicemia/HbA1c há &gt;3 anos\n\n\n\n\n\n3.24.10 Lacunas de Pé Diabético\n\n\n\n\n\n\n\n\nLacuna\nDescrição\nCritério\n\n\n\n\nlacuna_DM_sem_exame_pe_365d\nDM sem exame pé 365d\nDM E sem exame pé há &gt;365d\n\n\nlacuna_DM_sem_exame_pe_180d\nDM sem exame pé 180d\nDM E sem exame pé há &gt;180d\n\n\nlacuna_DM_nunca_teve_exame_pe\nDM &gt;1a nunca teve exame\nDM há &gt;1 ano E nunca teve exame pé",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#referências-clínicas",
    "href": "docu_enxuto.html#referências-clínicas",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.25 Referências Clínicas",
    "text": "3.25 Referências Clínicas\n\n3.25.1 Framingham Risk Score\n\nWilson PWF, et al. Prediction of Coronary Heart Disease Using Risk Factor Categories. Circulation. 1998.\n\n\n\n3.25.2 Estratificação SBC\n\nDiretrizes Brasileiras de Dislipidemias e Prevenção da Aterosclerose - 2017\n\n\n\n3.25.3 CKD-EPI 2021\n\nInker LA, et al. New Creatinine- and Cystatin C-Based Equations to Estimate GFR without Race. NEJM. 2021.\n\n\n\n3.25.4 ATP III (Dislipidemia)\n\nExecutive Summary of The Third Report of The National Cholesterol Education Program (NCEP). JAMA. 2001.\n\n\n\n3.25.5 Charlson Comorbidity Index\n\nCharlson ME, et al. A new method of classifying prognostic comorbidity in longitudinal studies. J Chronic Dis. 1987.\nQuan H, et al. Updating and Validating the Charlson Comorbidity Index. J Clin Epidemiol. 2011.\n\n\n\n3.25.6 Metas de Controle\n\nDiretrizes SBC para Hipertensão Arterial - 2020\nDiretrizes SBD para Diabetes Mellitus - 2022\nKDIGO Guidelines for CKD - 2024",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#ordenação-final",
    "href": "docu_enxuto.html#ordenação-final",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.26 Ordenação Final",
    "text": "3.26 Ordenação Final\nO SELECT final ordena os pacientes por prioridade clínica:\nORDER BY \n    CASE risco_cardiovascular  \n        WHEN 'MUITO ALTO' THEN 1\n        WHEN 'ALTO' THEN 2\n        WHEN 'INTERMEDIÁRIO' THEN 3\n        WHEN 'BAIXO' THEN 4\n        ELSE 5\n    END,\n    percentual_risco_10_anos DESC NULLS LAST\nLógica: Pacientes de maior risco cardiovascular aparecem primeiro, e dentro de cada categoria, ordenados pelo percentual de risco decrescente.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  },
  {
    "objectID": "docu_enxuto.html#metadados",
    "href": "docu_enxuto.html#metadados",
    "title": "3  Documentação Técnica: MM_exames_e_risco_A1C",
    "section": "3.27 Metadados",
    "text": "3.27 Metadados\n\n\n\nCampo\nValor\n\n\n\n\ndata_calculo\nData de execução da query\n\n\nGranularidade\n1 linha por CPF\n\n\nAtualização\nSob demanda\n\n\n\n\nDocumentação gerada em novembro de 2025 Navegador Clínico - Multimorbidade | SMS-RJ",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Documentação Técnica: MM_exames_e_risco_A1C</span>"
    ]
  }
]